<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yoursite.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Luzy&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Luzy&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Luzy">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://yoursite.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Luzy's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Luzy's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Luzy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/thunk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/thunk/" class="post-title-link" itemprop="url">thunk</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="什么是Thunk"><a href="#什么是Thunk" class="headerlink" title="什么是Thunk"></a>什么是Thunk</h3><p>是一个函数式编程的黑科技为了去延迟执行</p>
<h3 id="形如"><a href="#形如" class="headerlink" title="形如"></a>形如</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function thunkedYell(text)&#123;</span><br><span class="line">    return function thunk () &#123;</span><br><span class="line">        console.log(text + &#x27;!&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const thunkedYell = text=&gt; ()=&gt; console.log(text + &#x27;!&#x27;)</span><br></pre></td></tr></table></figure>
<p>其中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">()=&gt; console.log(text + &#x27;!&#x27;)就是thunk</span><br></pre></td></tr></table></figure>


<h3 id="redux-thunk"><a href="#redux-thunk" class="headerlink" title="redux-thunk"></a><code>redux-thunk</code></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function createThunkMiddleware(extraArgument)&#123;</span><br><span class="line">    return(&#123;dispatch,getState&#125;) =&gt; (next)=&gt;(action)=&gt;&#123;</span><br><span class="line">        if(typeof action === &#x27;function&#x27;)&#123;</span><br><span class="line">            return action(dispatch,getState,extraArgument);</span><br><span class="line">        &#125;</span><br><span class="line">        return next(action)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://medium.com/fullstack-academy/thunks-in-redux-the-basics-85e538a3fe60">参考链接</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/typeof-instanceof-%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/typeof-instanceof-%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">typeof && instanceof 详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JS%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">JS相关</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JS%E7%9B%B8%E5%85%B3/typeof-instanceof/" itemprop="url" rel="index"><span itemprop="name">typeof && instanceof</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="typeof和instanceof的区别"><a href="#typeof和instanceof的区别" class="headerlink" title="typeof和instanceof的区别"></a>typeof和instanceof的区别</h3><h4 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a><code>typeof</code></br></h4><p>在JavaScript中，判断一个变量的类型常常会用<code>typeof</code>运算符，在使用<code>typeof</code>运算符时采用引用类型存储值会出现一个问题，无论引用的是什么类型的对象，它都返回”object”</p>
<h4 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a><code>instanceof</code></br></h4><ul>
<li>语法</br><br>  <code>object instanceof constructor</code></br></li>
</ul>
<p><code>instanceof</code>运算符用来检测一个<strong>对象</strong>在其原型链中是否存在一个构造函数的prototyep属性</p>
<h3 id="Object-prototype-toString"><a href="#Object-prototype-toString" class="headerlink" title="Object.prototype.toString"></a>Object.prototype.toString</h3><p>默认情况下（不覆盖<code>toString</code>方法前提下），任何一个对象调用<code>Object</code>原生的<code>toString</code>方法都会返回<code>[Object type]</code>,其中<code>type</code>是对象的类型。</p>
<h4 id="1、-Class"><a href="#1、-Class" class="headerlink" title="1、[[Class]]"></a>1、[[Class]]</h4><p>每个实例都有一个<code>[[Class]]</code>属性，这个属性中就指定了上述字符串中的<code>type</code>(构造函数名)。<code>[[Class]]</code>不能直接地被访问，但通常可以间接地通过在这个值上借用默认的<code>Object.prototype.toString.call(..)</code>方法调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Object.prototype.toString.call(&quot;abc&quot;); // &quot;[object String]&quot;</span><br><span class="line">Object.prototype.toString.call(100); // &quot;[object Number]&quot;</span><br><span class="line">Object.prototype.toString.call(true); // &quot;[object Boolean]&quot;</span><br><span class="line">Object.prototype.toString.call(null); // &quot;[object Null]&quot;</span><br><span class="line">Object.prototype.toString.call(undefined); // &quot;[object Undefined]&quot;</span><br><span class="line">Object.prototype.toString.call([1,2,3]); // &quot;[object Array]&quot;</span><br><span class="line">Object.prototype.toString.call(/\w/); // &quot;[object RegExp]&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="JS中数据类型"><a href="#JS中数据类型" class="headerlink" title="JS中数据类型"></a>JS中数据类型</h3><p>数字、字符串、布尔三者，在JS中称为原始的(primitives)类型，再加上<code>null</code>与<code>undefined</code>也是。除了这些数据类型外，其他的都是对象。</p>
<h3 id="包装对象"><a href="#包装对象" class="headerlink" title="包装对象"></a>包装对象</h3><p>对象中有一类是Number、String、Boolean这三个对象，分别对应数字、字符串、布尔类型，我们称它们为包装对象或包装对象类型(Wrappers)</p>
<ul>
<li>原始-&gt;包装： new Number(123)</li>
<li>包装-&gt;原始：(new Number(123)).valueOf()</li>
</ul>
<p>包装对象是个对象，所以它与原始资料类型并不同，用<code>typeof</code>与<code>instanceof</code>可以检测出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">typeof 123 // &#x27;number&#x27;</span><br><span class="line">typeof new Number(123) //&quot;object&quot;</span><br><span class="line">123 instanceof Number //false</span><br></pre></td></tr></table></figure>

<h3 id="调用Number、String、Boolean函数，是转换其他类型到这个类型的语法"><a href="#调用Number、String、Boolean函数，是转换其他类型到这个类型的语法" class="headerlink" title="调用Number、String、Boolean函数，是转换其他类型到这个类型的语法"></a>调用Number、String、Boolean函数，是转换其他类型到这个类型的语法</h3><p>在不使用<code>new</code>关键字构建对象实例时，使用像<code>Number(123)</code>这样的语法，这是一种从其他资料类型要转到数字类型的函数调用方法。调用后仍然是原始资料类型，并不会产生包装对象类型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var a = Number(123);</span><br><span class="line">typeof a; //&quot;number&quot;</span><br><span class="line"></span><br><span class="line">var b = Number(&#x27;1.99&#x27;);</span><br><span class="line">typeof b;//&quot;number&quot;</span><br></pre></td></tr></table></figure>

<p><a href="https://segmentfault.com/q/1010000007552319">参考链接</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/webpack%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/webpack%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">webpack基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>本质上，<strong>webpack</strong>是一个现代JavaScript应用程序的静态模块打包工具。当webpack处理应用程序时，它会在内部构建一个依赖图，此依赖图会映射项目所需的每个模块，并生成一个或多个bundle。简而言之，就是处理模块依赖，并将它们合并成可用的静态资源。</p>
<h3 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h3><h4 id="（1）-项目中使用的每个文件都是个模块-module"><a href="#（1）-项目中使用的每个文件都是个模块-module" class="headerlink" title="（1） 项目中使用的每个文件都是个模块(module)"></a>（1） 项目中使用的每个文件都是个模块(module)</h4><h4 id="（2）-通过互相引用-这些模块形成一个图的数据结构"><a href="#（2）-通过互相引用-这些模块形成一个图的数据结构" class="headerlink" title="（2） 通过互相引用,这些模块形成一个图的数据结构"></a>（2） 通过互相引用,这些模块形成一个图的数据结构</h4><h4 id="（3）-在打包过程中，模块被合并成chunk-chunk合并成chunk组，并形成一个通过模块互相连接的图-ModuleGraph-。"><a href="#（3）-在打包过程中，模块被合并成chunk-chunk合并成chunk组，并形成一个通过模块互相连接的图-ModuleGraph-。" class="headerlink" title="（3） 在打包过程中，模块被合并成chunk.chunk合并成chunk组，并形成一个通过模块互相连接的图(ModuleGraph)。"></a>（3） 在打包过程中，模块被合并成chunk.chunk合并成chunk组，并形成一个通过模块互相连接的图(ModuleGraph)。</h4><h4 id="（4）-一个chunk组中可能有多个chunk-例如，SplitChunksPlugin会将一个chunk拆分为一个或多个chunk"><a href="#（4）-一个chunk组中可能有多个chunk-例如，SplitChunksPlugin会将一个chunk拆分为一个或多个chunk" class="headerlink" title="（4） 一个chunk组中可能有多个chunk,例如，SplitChunksPlugin会将一个chunk拆分为一个或多个chunk"></a>（4） 一个chunk组中可能有多个chunk,例如，<code>SplitChunksPlugin</code>会将一个chunk拆分为一个或多个chunk</h4><h4 id="（5）-chunk的两种形式"><a href="#（5）-chunk的两种形式" class="headerlink" title="（5） chunk的两种形式"></a>（5） chunk的两种形式</h4><ul>
<li><code>initial(初始化)</code>是入口起点的main chunk。此chunk包含为入口起点指定的所有模块及其依赖项。</li>
<li><code>non-initial</code>是可以延迟加载的块。可能会出现在使用<code>动态导入（dynamic imports）</code>或者<code>SplitChunksPlugin</code>时。</li>
</ul>
<p>需要说明的是，<code>non-initial</code>chunk没有名称，因此会使用唯一ID来替代名称。在使用动态导入时，我们可以通过<code>magic comment</code>来显式指定chunk名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import(</span><br><span class="line">  /* webpackChunkName: &quot;app&quot; */</span><br><span class="line">  &#x27;./app.jsx&#x27;</span><br><span class="line">).then((App) =&gt; &#123;</span><br><span class="line">  ReactDOM.render(&lt;App /&gt;, root);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h4><ul>
<li>入口（entry）</li>
<li>输出（output）</li>
<li>loader</li>
<li>插件（plugin）</li>
<li>模式（mode）</li>
</ul>
<h3 id="入口起点（entry-points）"><a href="#入口起点（entry-points）" class="headerlink" title="入口起点（entry points）"></a>入口起点（entry points）</h3><p>指示webpack应该使用哪个模块，将其作为构建其内部依赖图的开始。进入入口起点后，webpack会找到有哪些模块和库是入口七点（直接和间接）依赖的。</p>
<h4 id="单个入口"><a href="#单个入口" class="headerlink" title="单个入口"></a>单个入口</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: &#x27;./path/to/my/entry/file.js&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="多入口"><a href="#多入口" class="headerlink" title="多入口"></a>多入口</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: &#x27;./src/app.js&#x27;,</span><br><span class="line">    adminApp: &#x27;./src/adminApp.js&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="输出（output）"><a href="#输出（output）" class="headerlink" title="输出（output）"></a>输出（output）</h3><p>告诉webpack在哪里输出它所创建的bundle,以及如何命名这些文件。主要输出文件的默认值是<code>./dist/main.js</code>，其他生成文件默认放置在<code>./dist</code>文件夹中。</p>
<h4 id="单入口"><a href="#单入口" class="headerlink" title="单入口"></a>单入口</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: &#x27;bundle.js&#x27;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="多个起点"><a href="#多个起点" class="headerlink" title="多个起点"></a>多个起点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: &#x27;./src/app.js&#x27;,</span><br><span class="line">    search: &#x27;./src/search.js&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: &#x27;[name].js&#x27;,</span><br><span class="line">    path: __dirname + &#x27;/dist&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 写入到硬盘：./dist/app.js, ./dist/search.js</span><br></pre></td></tr></table></figure>

<h3 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h3><p>webpack只能理解JavaScript和JSON文件。<code>loader</code>让webpack能够去处理其他类型的文件，并将它们转化为有效模块，以供应用程序使用，以及被添加到依赖图中。</br></p>
<p>在webpack的配置中loader有两个属性：</p>
<ul>
<li><code>test</code>属性，用于标识出应该被对应的<code>loader</code>进行转换的某个或某些文件</li>
<li><code>use</code>属性，表示进行转换用哪个loader。</li>
</ul>
<h4 id="常见Loaders"><a href="#常见Loaders" class="headerlink" title="常见Loaders"></a>常见<code>Loaders</code></h4><ul>
<li><p><code>babel-loader</code></br><br>转换ES6、ES7等JS新特性语法</p>
</li>
<li><p><code>css-loader</code></br><br>支持.css文件的加载和解析</p>
</li>
<li><p><code>less-loader</code></br><br>将less文件转换成css</p>
</li>
<li><p><code>ts-loader</code></br><br>将TS转换成JS</p>
</li>
<li><p><code>file-loader</code></br><br>进行图片、字体等的打包</p>
</li>
<li><p><code>raw-loader</code></br><br>将文件以字符串的形式导入</p>
</li>
<li><p><code>thread-loader</code></br><br>多进程打包JS和CSS</p>
</li>
</ul>
<h3 id="插件（plugin）"><a href="#插件（plugin）" class="headerlink" title="插件（plugin）"></a>插件（plugin）</h3><p>loader用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。包括：打包优化，资源管理，注入环境变量。</p>
<p>webpack.config.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);//通过 npm 安装</span><br><span class="line"></span><br><span class="line">const webpack = require(&#x27;webpack&#x27;);//用于访问内置插件</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    module:&#123;</span><br><span class="line">        rules:[</span><br><span class="line">            &#123; test: /\.txt$/, use: &#x27;raw-loader&#x27; &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        new HtmlWebpackPlugin(&#123;template: &#x27;./src/index.html&#x27;&#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的示例中，<code>html-webpack-plugin</code>为应用程序生成一个HTML文件，并自动注入所有生成的bundle。</p>
<h4 id="常见的Plugins"><a href="#常见的Plugins" class="headerlink" title="常见的Plugins"></a>常见的Plugins</h4><ul>
<li><code>CommonsChunkPlugin</code></br><br>将chunks相同的模块代码提取成公共JS</li>
<li><code>CleanWebpackPlugin</code></br><br>清空构建目录</li>
<li><code>ExtractTextWebpackPlugin</code></br><br>将CSS从bundle文件中提取成一个独立的CSS文件</li>
<li><code>CopyWebpackPlugin</code></br><br>将文件或者文件夹拷贝到构建的输出目录</li>
<li><code>HtmlWebpackPlugin</code></br><br>创建html文件去承载输出的bundle</li>
<li><code>UglifyjsWebpackPlugin</code></br><br>压缩JS</li>
<li><code>ZipWebpackPlugin</code></br><br>将打包出的资源生成一个zip包</li>
</ul>
<h3 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h3><h4 id="webpack-watch-mode-webpack观察模式"><a href="#webpack-watch-mode-webpack观察模式" class="headerlink" title="webpack watch mode(webpack观察模式)"></a><code>webpack watch mode(webpack观察模式)</code></h4><p>使用<code>webpack --watch</code>命令依赖图中所有文件的更改。如果其中一个文件被更新，代码将重新编译，所以你不必再去手动运行整个构建。</p>
<h4 id="使用-webpack-dev-server"><a href="#使用-webpack-dev-server" class="headerlink" title="使用 webpack-dev-server"></a>使用 webpack-dev-server</h4><p><code>webpack-dev-server</code>为你提供了一个简单的web server,并且具有live reloading(实时重新加载)功能。</p>
<blockquote>
<p><code>webpack-dev-server</code>在编译之后不会写入到任何输出文件，而是将bundle文件保留在内存中，然后将它们serve到server中，就好像它们是挂载在server根路径上的真实文件一样。如果你的页面希望在其他不同路径中找到bundle文件，则可以通过dev server配置中的<code>publicPath</code>选项中进行修改</p>
</blockquote>
<h3 id="使用webpack-dev-middleware"><a href="#使用webpack-dev-middleware" class="headerlink" title="使用webpack-dev-middleware"></a>使用webpack-dev-middleware</h3><p><code>webpack-dev-middle</code>是一个封装器(wrapper)，它可以把webpack处理过的文件发送到一个server。<code>webpack-dev-server</code>在内部使用了它，然而它也可以作为一个单独的package来使用，以便根据需求进行跟多自定义设置。</p>
<h3 id="运用"><a href="#运用" class="headerlink" title="运用"></a>运用</h3><h4 id="配置html模板"><a href="#配置html模板" class="headerlink" title="配置html模板"></a>配置html模板</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&#x27;path&#x27;);</span><br><span class="line">const HtmlwebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);</span><br><span class="line">const &#123;CleanWebpackPlugin&#125; = require(&#x27;clean-webpack-plugin&#x27;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  mode:&#x27;development&#x27;,//开发模式</span><br><span class="line">  entry: &#123;</span><br><span class="line">      main: &#x27;./main.js&#x27;, //入口文件</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: &#x27;[name].[hash:8].js&#x27;,//打包后的文件名称</span><br><span class="line">    path: path.resolve(__dirname,&#x27;dist&#x27;) //打包后的目录</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve:&#123;</span><br><span class="line">    alias:&#123;</span><br><span class="line">        &#x27;vue$&#x27;:&#x27;vue/dist/vue.runtime.esm.js&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    extensions:[&#x27;*&#x27;,&#x27;.js&#x27;,&#x27;.json&#x27;,&#x27;.vue&#x27;]</span><br><span class="line">  &#125;,</span><br><span class="line">   plugins:[</span><br><span class="line">      new HtmlwebpackPlugin(&#123;</span><br><span class="line">          template:&#x27;index.html&#x27;,</span><br><span class="line">          filename:&#x27;index.html&#x27;,</span><br><span class="line">      &#125;),</span><br><span class="line">    new CleanWebpackPlugin(),</span><br><span class="line">  ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>


<p><a href="https://webpack.docschina.org/configuration/output/#output-publicpath">官方文档</a></p>
<p><a href="https://juejin.im/post/5de87444518825124c50cd36#heading-33">参考文章</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/withRouter%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/withRouter%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">withRouter使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/Router/" itemprop="url" rel="index"><span itemprop="name">Router</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>withRouter是react-route的一个高阶组件，可获取history</p>
<p>render时会把match,location和history传入props</p>
<h3 id="history"><a href="#history" class="headerlink" title="history"></a><code>history</code></h3><ul>
<li><code>action</code></br><br>可得知路由栈的操作是<code>POP</code>、<code>PUSH</code>、<code>REPLACE</code></li>
</ul>
<h3 id="location"><a href="#location" class="headerlink" title="location"></a><code>location</code></br></h3><pre><code>- `pathname`当前路由的绝对路径
- `search`查询参数，访问`/user?userId=123`=&gt;可以拿到`?userId=123`
- `hash`:`#the-hash`
- `state`:类似vue的路由元信息`meta`,在这里的存储的信息不会明文显示在浏览器上
</code></pre>
<h3 id="match"><a href="#match" class="headerlink" title="match"></a><code>match</code></br></h3><pre><code>- `params`当`&lt;Route to=&#39;/user/:id&#39; component=&#123;user&#125;&gt;`,访问`/user/123`在`user`组件中。`this.props.match.params.id`可以获取id
- `isExact`,当前路由是不是完全匹配
</code></pre>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>路由组件是可以直接获取这些属性（<code>history</code>、<code>location</code>,<code>match</code>）,而非路由组件就必须通过<code>withRouter</code>修饰后才能获取这些属性。<br>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=&#x27;/&#x27; component=&#123;App&#125; /&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>App组件就可以直接获取路由中这些属性，但是，如果App组件汇总有一个子组件<code>Foo</code>，那么<code>Foo</code>就不能直接获取路由中的属性了，必须通过<code>withRouter</code>修饰后才能获取到</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/i18n%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/i18n%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">i8n介绍</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9B%BD%E9%99%85%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">国际化</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="名字的由来"><a href="#名字的由来" class="headerlink" title="名字的由来"></a>名字的由来</h3><p>国际化(internationalization)又称为 i18n(读法为 i 18 n，据说是因为 internationalization(国际化)这个单词从 i 到 n 之间有 18 个英文字母，i18n 的名字由此而来)</p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import i18n from &#x27;i18next&#x27;;</span><br><span class="line"></span><br><span class="line">// 初始化 i18n 实例，命名空间默认是translation</span><br><span class="line">i18n.init(&#123;</span><br><span class="line">  lng: &#x27;en&#x27;,</span><br><span class="line">  ns: [&#x27;translation&#x27;],</span><br><span class="line">  defaultNS: &#x27;translation&#x27;,</span><br><span class="line">  resources: &#123;</span><br><span class="line">    en: &#123;</span><br><span class="line">      translation: &#123;</span><br><span class="line">        welcome: &#x27;Welcome&#x27;,</span><br><span class="line">        goodbye: &#x27;Goodbye&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 使用 addResourceBundle 添加资源</span><br><span class="line">i18n.addResourceBundle(&#x27;en&#x27;, &#x27;translation&#x27;, &#123;</span><br><span class="line">  welcome: &#x27;Hello&#x27;, // 更新现有资源</span><br><span class="line">  newKey: &#x27;New Key&#x27;, // 添加新资源</span><br><span class="line">&#125;, true);</span><br><span class="line"></span><br><span class="line">// 输出结果</span><br><span class="line">console.log(i18n.t(&#x27;welcome&#x27;)); // 输出 &quot;Hello&quot;（已更新）</span><br><span class="line">console.log(i18n.t(&#x27;goodbye&#x27;)); // 输出 &quot;Goodbye&quot;</span><br><span class="line">console.log(i18n.t(&#x27;newKey&#x27;)); // 输出 &quot;New Key&quot;</span><br><span class="line">console.log(i18n.t(&#x27;newKey&#x27;,&#123;ns:&#x27;translation&#x27;&#125;)) //输出 &quot;New Key&quot;</span><br></pre></td></tr></table></figure>

<h3 id="API-解释"><a href="#API-解释" class="headerlink" title="API 解释"></a>API 解释</h3><h4 id="addResourceBundle-和-addResources"><a href="#addResourceBundle-和-addResources" class="headerlink" title="addResourceBundle 和 addResources"></a>addResourceBundle 和 addResources</h4><p><code>addResourceBundle</code>这个方法主要用于向特定的语言和命名空间添加或更新资源。如果你需要在运行时动态地添加或更新翻译资源，或者你有一个复杂的资源对象需要合并到现有的资源中;</p>
<p><code>addResources</code>这个方法主要用于一次性向特定的语言和命名空间批量添加资源。如果你有一组翻译资源需要添加，而不需要合并到现有的资源中.</p>
<h4 id="getResource-和-getResourceBundle"><a href="#getResource-和-getResourceBundle" class="headerlink" title="getResource 和 getResourceBundle"></a>getResource 和 getResourceBundle</h4><p><code>getResource</code>这个方法用于获取特定语言、命名空间和键的翻译资源。如果你需要在应用程序中访问某个特定翻译资源，譬如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const welcomeResource = i18n.getResource(&#x27;en&#x27;, &#x27;translation&#x27;, &#x27;welcome&#x27;);</span><br><span class="line">console.log(welcomeResource); // 输出 &quot;Welcome&quot;</span><br></pre></td></tr></table></figure>

<p><code>getResourceBundle</code>这个方法用于获取特定语言和命名空间的整个资源对象。如果你需要访问一个命名空间中的所有翻译资源，譬如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const resourceBundle = i18n.getResourceBundle(&#x27;en&#x27;, &#x27;translation&#x27;);</span><br><span class="line">console.log(resourceBundle); // 输出 &#123; welcome: &#x27;Welcome&#x27;, goodbye: &#x27;Goodbye&#x27;, ... &#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/package-lock%E7%9B%B8%E5%85%B3%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/package-lock%E7%9B%B8%E5%85%B3%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">package-lock相关介绍</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/npm/" itemprop="url" rel="index"><span itemprop="name">npm</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="自-npm-5-0-版本发布以来，npm-i-的规则发生了三次变化。"><a href="#自-npm-5-0-版本发布以来，npm-i-的规则发生了三次变化。" class="headerlink" title="自 npm 5.0 版本发布以来，npm i 的规则发生了三次变化。"></a>自 npm 5.0 版本发布以来，npm i 的规则发生了三次变化。</h2><p>1、 npm 5.0.x 版本，不管 package.json 怎么变，npm i 时都会根据 lock 文件下载</p>
<p>2、5.1.0 版本后 npm install 会无视 lock 文件 去下载最新的 npm</p>
<p>3、5.4.2 版本后，如果改了 package.json，且 package.json 和 lock 文件不同，那么执行<code>npm i</code>时 npm 会根据 package 中的版本号以及语义含义去下载最新的包，并更新至 lock</p>
<h2 id="如何禁用npm-install会自动更新package-lock-json"><a href="#如何禁用npm-install会自动更新package-lock-json" class="headerlink" title="如何禁用npm install会自动更新package-lock.json"></a>如何禁用<code>npm install</code>会自动更新<code>package-lock.json</code></h2><p><code>~/.npmrc package-lock=false </code></p>
<h2 id="npm-ci和npm-install区别"><a href="#npm-ci和npm-install区别" class="headerlink" title="npm ci和npm install区别"></a><code>npm ci</code>和<code>npm install</code>区别</h2><p>1、 npm ci 安装确切的软件包版本</p>
<p>与 <code>npm install</code> 不同，<code>npm install</code> 将软件包完全按照 package-lock.json 文件中指定的版本安装。这样可以确保项目中所有开发人员使用的依赖库版本相同，便于版本管理。</p>
<p>2、 npm ci 先删除 node_modules 目录</p>
<p>3、npm ci 不使用缓存</p>
<p>4、npm ci 比 npm install 更快</p>
<h2 id="npm-ci报错-gyp-No-Xcode-or-CLT-version-detected-报错"><a href="#npm-ci报错-gyp-No-Xcode-or-CLT-version-detected-报错" class="headerlink" title="npm ci报错 gyp: No Xcode or CLT version detected! 报错"></a><code>npm ci</code>报错 gyp: No Xcode or CLT version detected! 报错</h2><p>在命令行内重新安装 xcode,记得在弹窗服务条款时点击“同意”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure>

<p>或者去 appStore 内重新安装 xcode</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/mvvm%E6%8E%A2%E7%A9%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/mvvm%E6%8E%A2%E7%A9%B6/" class="post-title-link" itemprop="url">mvvm探究</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">响应式原理</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ul>
<li>实现一个数据监听器<code>Observer</code>,能够对数据对象的所有的属性进行监听，如有变动可拿到最新值并通知订阅者。</li>
<li>实现一个指令解析器<code>Compile</code>，对每个元素节点的指令进行扫描和解析，根据指令模板替换数据，以及绑定相应的更新函数。</li>
<li>实现一个Watcher，作为连接<code>Observer</code>和<code>Compile</code>的桥梁，能够订阅并收到每个属性变动的通知，执行指令绑定的相应回调函数，从而更新视图。</li>
</ul>
<h3 id="实现Observer"><a href="#实现Observer" class="headerlink" title="实现Observer"></a>实现Observer</h3><ul>
<li>作用：给对象的属性添加getter和setter,用于依赖收集和派发更新</li>
</ul>
<p>利用<code>Object.defineProperty()</code>来监听属性变动那么将需要observer的数据对象进行递归遍历，包括子属性对象的属性，都加上<code>setter</code>和<code>getter</code>这样的话，给这个对象的某个赋值，就会触发<code>setter</code>，那么就能监听到了数据变化。代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">var data = &#123;name:&#x27;kindeng&#x27;&#125;;</span><br><span class="line">observer(data);</span><br><span class="line">data.name = &#x27;dmp&#x27;;//监听到值变化了 kindeng ---&gt; dmq</span><br><span class="line"></span><br><span class="line">function observer(data)&#123;</span><br><span class="line">    if(!data || typeof data !== &#x27;object&#x27;)&#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    Object.keys(data).forEach(functioin(key)&#123;</span><br><span class="line">        defineReactive(data,key,data[key]);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function defineReactive(data,key,val)&#123;</span><br><span class="line">    observe(val); //监听子属性</span><br><span class="line">    Object.defineProperty(data,key,&#123;</span><br><span class="line">        enumerable:true,//可枚举</span><br><span class="line">        configurable:false,//不能再define</span><br><span class="line">        get:function()&#123;</span><br><span class="line">            return val;</span><br><span class="line">        &#125;,</span><br><span class="line">        set:function(newVal)&#123;</span><br><span class="line">            console.log(&#x27;监听到值变化了&#x27;,val,&#x27;----&gt;&#x27;,newValue);</span><br><span class="line">            val = newVal;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们已经可以监听每个数据的变化了，那么监听到变化之后就是怎么通知订阅者了，所以接下来需要实现一个消息订阅器，很简单，维护一个数组，用来收集订阅者，数据变动触发notify,再调用订阅者的update方法，代码改善之后如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//...省略</span><br><span class="line">function defineReactive(data,key,val)&#123;</span><br><span class="line">    var dep = new Dep();</span><br><span class="line">    observal(val);//监听子属性</span><br><span class="line">    </span><br><span class="line">    Object.defineProperty(data,key,&#123;</span><br><span class="line">        // ...省略</span><br><span class="line">        set:function(newVal)&#123;</span><br><span class="line">            if(val === newVal) return;</span><br><span class="line">            console.log(&#x27;监听到值变化了&#x27;,val,&#x27;----&gt;&#x27;,newVal);</span><br><span class="line">            val = newVal;</span><br><span class="line">            dep.notify();//通知所有订阅者</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Dep()&#123;</span><br><span class="line">    this.subs = [];</span><br><span class="line">&#125;</span><br><span class="line">Dep.prototype = &#123;</span><br><span class="line">    addSub:function(sub)&#123;</span><br><span class="line">        this.subs.push(sub);</span><br><span class="line">    &#125;,</span><br><span class="line">    notify:function()&#123;</span><br><span class="line">        this.subs.forEach(function(dub)&#123;</span><br><span class="line">            sub.update();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之前我们已经明确了<code>Watcher</code>是订阅者，而且<code>var dep = new Dep()</code>;是在<code>defineReactive</code>方法内部定义的，所以想通过<code>dep</code>添加订阅者，就必须要在闭包内操作，所以我们可以在<code>getter</code>里面动手脚：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//Observer.js</span><br><span class="line">//...省略</span><br><span class="line">Object.defineProperty(data,key,&#123;</span><br><span class="line">    get:function()&#123;</span><br><span class="line">        //由于需要在闭包内添加Watcher，所以通过Dep定义一个全局target属性，暂存watcher,添加完移除</span><br><span class="line">        Dep.target &amp;&amp; dep.addDep(Dep.target);</span><br><span class="line">        return val;</span><br><span class="line">    &#125;</span><br><span class="line">    // ...省略</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// Watcher.js</span><br><span class="line">Watcher.prototype = &#123;</span><br><span class="line">    get:function(key)&#123;</span><br><span class="line">        Dep.target = this;</span><br><span class="line">        this.value = data[key];//这里会触发属性的getter,从而添加订阅者</span><br><span class="line">        Dep.target = null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Dep"><a href="#Dep" class="headerlink" title="Dep"></a>Dep</h3><p><code>Dep</code>是一个Class,它定义了一些属性和方法，这里需要特别注意的是它有一个静态属性<code>target</code>,这是一个全局唯一<code>Watcher</code>,这是一个非常巧妙的设计，<strong>因为在同一时间只能有一个全局的Watcher</strong></p>
<p><code>Dep</code>实际上就是对<code>Watcher</code>的一种管理</p>
<h3 id="实现Compile"><a href="#实现Compile" class="headerlink" title="实现Compile"></a>实现Compile</h3><p>compile主要做的事情是解析模板指令，将模板中的变量替换成数据，然后初始化渲染页面视图，并将每个指令对应的节点绑定更新函数，添加监听数据的订阅者，一旦数据有变动，收到通知，更新视图。</p>
<p>因为遍历解析的过程有多次操作dom节点，为提高性能和效率，会先将vue实例根节点的<code>el</code>转换成文档碎片<code>fragment</code>进行解析编译操作，解析完成，再将<code>fragment</code>添加回原来的真实dom节点中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function Compile(el)&#123;</span><br><span class="line">    this.$el = this.isElementNode(el)?el:documennt.querySelector(el);</span><br><span class="line">    if(this.$el)&#123;</span><br><span class="line">        this.$fragment = this.node2Fragment(this.$el);</span><br><span class="line">        this.init();</span><br><span class="line">        this.$el.appendChild(this.$fragment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Compile.prototype = &#123;</span><br><span class="line">    init:function()&#123;this.compileElement(this.$fragment);&#125;,</span><br><span class="line">    node2Fragment:function(el)&#123;</span><br><span class="line">        var fragment = document.createDocumentFragment(),child;</span><br><span class="line">        //将原生节点拷贝到fragment</span><br><span class="line">        while(child = el.firstChild)&#123;</span><br><span class="line">            fragment.appendChild(child)</span><br><span class="line">        &#125;</span><br><span class="line">        return fragment</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>compileElement方法将遍历所有节点及其子节点，进行扫描解析编译，调用对应的指令渲染函数进行数据渲染，并调用对应的指令更新函数进行绑定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Compile.prototype = &#123;</span><br><span class="line">    //...省略</span><br><span class="line">    compileElement:function(el)&#123;</span><br><span class="line">        var childNodes = el.childNodes, me = this;</span><br><span class="line">        [].slice.call(childNodes).forEach(function(node)&#123;</span><br><span class="line">            var text = node.textContent;</span><br><span class="line">            var reg = /\&#123;\&#123;(.*)\&#125;\&#125;/;//表达式文本</span><br><span class="line">            // 按元素节点方式编译</span><br><span class="line">            if(me.isElementNode(node))&#123;</span><br><span class="line">                me.compile(node);</span><br><span class="line">            &#125;else if(me.isTextNode(node) &amp;&amp; reg.test(text))&#123;</span><br><span class="line">                me.compileText(node,RegExp.$1);</span><br><span class="line">            &#125;</span><br><span class="line">            //遍历编译子节点</span><br><span class="line">            if(node.childNodes &amp;&amp; node.childNodes.length)&#123;</span><br><span class="line">                me.compileElement(node);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    compile:function(node)&#123;</span><br><span class="line">        var nodeAttrs = node.attributes, me = this;</span><br><span class="line">        [].slice.call(nodeAttrs).forEach(function(attr)&#123;</span><br><span class="line">            //规定：指令以 v-xxx 命令</span><br><span class="line">            // 如&lt;span v-text=&quot;content&quot;&gt;&lt;/span&gt;中指令为v-text</span><br><span class="line">            var attrName = attr.name; //v-text</span><br><span class="line">        if(me.isDirective(attrName))&#123;</span><br><span class="line">            var exp = attr.value;//content</span><br><span class="line">            var dir = attrName.substring(2);//text</span><br><span class="line">            if(me.isEventDirective(dir))&#123;</span><br><span class="line">                //事件指令，如 v-on:click</span><br><span class="line">                compileUtil.eventHandler(node,me.$vm,exp,dir);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                // 普通指令</span><br><span class="line">                compileUtil[dir] &amp;&amp; compileUtil[dir](node,me.$vm,exp);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//指令处理集合</span><br><span class="line">var compileUtil = &#123;</span><br><span class="line">    text:function(node,vm,exp)&#123;</span><br><span class="line">        this.bind(node,vm,exp,&#x27;text&#x27;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //...省略</span><br><span class="line">    bind:function(node,vm,exp,dir)&#123;</span><br><span class="line">        var updateFn = update[dir + &#x27;Updater&#x27;];</span><br><span class="line">        //第一次初始化视图</span><br><span class="line">        updateFn &amp;&amp; updateFn(node,vm[exp]);</span><br><span class="line">        // 实例化订阅者，此操作会在对应的属性消息订阅器中添加了该订阅者Watcher</span><br><span class="line">        new Watcher(vm,exp,function(value,oldValue)&#123;</span><br><span class="line">            //一旦属性值有变化，会收到通知执行此更新函数，更新视图</span><br><span class="line">            updaterFn &amp;&amp; updateFn(node,value,oldValue);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//更新函数</span><br><span class="line">var updater = &#123;</span><br><span class="line">    textUpdater: function(node,value)&#123;</span><br><span class="line">        node.textConntent = typeof value === &#x27;undefined&#x27;?&#x27;&#x27;:value;</span><br><span class="line">    &#125;</span><br><span class="line">    //...省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里通过递归遍历保证了每个节点及子节点都会解析编译到，包括了{{ }}表达式声明的文本节点。监听数据、绑定更新函数的处理是在<code>compileUtil.bind()</code>这个方法中，通过<code>new Watcher()</code>添加回调来接收数据变化的通知。</p>
<h3 id="实现Watcher"><a href="#实现Watcher" class="headerlink" title="实现Watcher"></a>实现Watcher</h3><p>Watcher订阅者作为Observer和Compile之间通信的桥梁，主要做的事情是</p>
<ul>
<li>在自身实例化时往属性订阅器(dep)里面添加自己</li>
<li>自身必须有一个update()方法</li>
<li>待属性变动dep.notice()通知时，能调用自身的update()方法，并触发Compile中绑定的回调</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">function Watcher(vm,exp,cb)&#123;</span><br><span class="line">    this.cb = cb;</span><br><span class="line">    this.vm = vm;</span><br><span class="line">    this.exp = exp;</span><br><span class="line">    //此处为了触发属性的getter,从而在dep添加自己，结合Observer更容易理解</span><br><span class="line">    this.value = this.get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Watcher.prototype = &#123;</span><br><span class="line">    update:function()&#123;</span><br><span class="line">        this.run(); //属性值变化收到通知</span><br><span class="line">    &#125;,</span><br><span class="line">    run:function()&#123;</span><br><span class="line">        var value = this.get();//取到最新值</span><br><span class="line">        var oldValue = this.value;</span><br><span class="line">        if(value !== oldValue)&#123;</span><br><span class="line">            this.value = value;</span><br><span class="line">            this.cb.call(this.vm,value,oldVal);//执行Compile中绑定的回调，更新视图</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    get:function()&#123;</span><br><span class="line">        Dep.target = this;//将当前订阅者指向自己</span><br><span class="line">        var value = this.vm[exp]; //触发getter,添加自己到属性订阅器中</span><br><span class="line">        Dep.target = null;//添加完毕，重置</span><br><span class="line">        return value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">//这里再次列出Observer和Dep,方便理解</span><br><span class="line">Object.defineProperty(data,key,&#123;</span><br><span class="line">    get:function()&#123;</span><br><span class="line">        //由于需要在闭包内添加watcher,所以可以在Dep定义一个全局的target属性，暂存watcher,添加完移除</span><br><span class="line">        Dep.target &amp;&amp; dep.addDep(Dep.target);</span><br><span class="line">        return val;</span><br><span class="line">    &#125;</span><br><span class="line">    // ...省略</span><br><span class="line">&#125;);</span><br><span class="line">Dep.prototype = &#123;</span><br><span class="line">    notify:function()&#123;</span><br><span class="line">        this.subs.forEach(function(sub)&#123;</span><br><span class="line">            sub.update();//调用订阅者的update方法，通知变化</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实例化<code>Watcher</code>的时候，调用<code>get()</code>方法，通过<code>Dep.target = watcherInstance</code>标记订阅者是当前Watche实例，强行触发属性定义的<code>getter</code>方法，<code>getter</code>方法执行的时候，就会在属性的订阅器<code>dep</code>添加当前watcher实例，从而属性值有变化的时候，watcherinstance就能收到更新通知。</p>
<h4 id="补充实例化Watcher的场景"><a href="#补充实例化Watcher的场景" class="headerlink" title="补充实例化Watcher的场景"></a>补充实例化Watcher的场景</h4><ul>
<li>Vue实例化过程中的Watch选项</li>
<li>Vue实例化过程中的Computed计算属性选项</li>
<li>Vue原型上有挂载$watch方法：Vue.prototype.$watch,可以直接通过实例调用this.$watch方法</li>
<li>Vue生成了render函数，更新视图时</li>
</ul>
<h3 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick"></a>nextTick</h3><p>主线程的执行过程就是一个<code>tick</code></p>
<h3 id="实现MVVM"><a href="#实现MVVM" class="headerlink" title="实现MVVM"></a>实现MVVM</h3><p>MVVM作为数据绑定的入口，整合Observer、Compile和Watcher三者,通过Observer来监听自己的model数据变化，通过Compile来解析编译模板指令，最终利用Watcher搭起Observer和Compile之间的沟通桥梁。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function MVVM(options) &#123;</span><br><span class="line">    this.$options = options || &#123;&#125;;</span><br><span class="line">    var data = this._data = this.$options.data;</span><br><span class="line">    var me = this;</span><br><span class="line"></span><br><span class="line">    // 数据代理</span><br><span class="line">    // 实现 vm.xxx -&gt; vm._data.xxx</span><br><span class="line">    Object.keys(data).forEach(function(key) &#123;</span><br><span class="line">        me._proxyData(key);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    this._initComputed();</span><br><span class="line"></span><br><span class="line">    observe(data, this);</span><br><span class="line"></span><br><span class="line">    this.$compile = new Compile(options.el || document.body, this)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1、实例化MVVM的时候，会先调用observe就是Observer类的方法，从而对数据劫持。<br><strong>每个对象值的getter都持有一个<code>dep</code>,这里的dep是观察者管理器Dep类中有一个subs数组是用来收集watcher</strong></p>
<p>2、实例化Compile,传入模板,可以认为在模板上用到data选项（也就是被observe劫持的数据）里面的标签就是一个watcher实例</p>
<p>3、实例化watcher的同时，会触发劫持属性的get方法从而添加自己到订阅中去。<strong>即触发了<code>dep.depend()方法</code></strong></p>
<p>4、然后改变劫持属性的时候，会发送通知给watcher触发update方法更新</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/promiseMiiddleware/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/promiseMiiddleware/" class="post-title-link" itemprop="url">promiseMiddleware</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">export default function promiseMiddleware() &#123;</span><br><span class="line">  return next =&gt; action =&gt; &#123;</span><br><span class="line">    const &#123; promise, type, success, error, complete, isFetching, ...rest &#125; = action;</span><br><span class="line"></span><br><span class="line">    if(!promise) return next(action);</span><br><span class="line"></span><br><span class="line">    const SUCCESS = type + &#x27;_SUCCESS&#x27;;</span><br><span class="line">    const REQUEST = type + &#x27;_REQUEST&#x27;;</span><br><span class="line">    const FAILURE = type + &#x27;_FAILURE&#x27;;</span><br><span class="line"></span><br><span class="line">    next(&#123; ...rest, isFetching: true, type: REQUEST &#125;); </span><br><span class="line">    // promise完成回调，无论success or error都会执行</span><br><span class="line">    const completeCallback = (...args) =&gt; &#123;</span><br><span class="line">      typeof complete === &#x27;function&#x27; &amp;&amp; complete(...args);</span><br><span class="line">    &#125;;</span><br><span class="line">    return promise</span><br><span class="line">      .then(response =&gt; (&#123; json: response.data.data, status: response.statusText &#125;))</span><br><span class="line">      .then((&#123; json, status &#125;) =&gt; &#123;</span><br><span class="line">        next(&#123; ...rest, json, isFetching: false, type: SUCCESS &#125;);</span><br><span class="line">        completeCallback(true, json, next);</span><br><span class="line">        if(typeof success === &#x27;function&#x27;) &#123;</span><br><span class="line">          success(json, next);</span><br><span class="line">        &#125;</span><br><span class="line">        return json;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(err =&gt; &#123;</span><br><span class="line">        completeCallback(false, err, next);</span><br><span class="line">        if(typeof error === &#x27;function&#x27;) &#123;</span><br><span class="line">          error(err, next);</span><br><span class="line">        &#125;</span><br><span class="line">        next(&#123; ...rest, error: err, isFetching: false, type: FAILURE &#125;);</span><br><span class="line">        return err;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/sandbox/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/sandbox/" class="post-title-link" itemprop="url">前端沙盒</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/sandbox/" itemprop="url" rel="index"><span itemprop="name">sandbox</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="什么是前端沙盒"><a href="#什么是前端沙盒" class="headerlink" title="什么是前端沙盒"></a>什么是前端沙盒</h2><p>前端沙盒是一种技术手段，用于在浏览器环境中创建一个隔离的、受限制的代码执行环境。在这个环境中，我们可以执行一些不受信任的代码，而不用担心它会对我们的应用程序或用户数据造成伤害</p>
<h2 id="为什么需要沙盒"><a href="#为什么需要沙盒" class="headerlink" title="为什么需要沙盒"></a>为什么需要沙盒</h2><p>通过使用沙盒技术，我们可以防止恶意代码的执行，保护用户数据和隐私。此外，沙盒还可以帮助我们限制代码的功能和访问权限，以防止其执行不安全的操作。</p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul>
<li><p>第三方代码集成<br>在 Web 应用中，我们经常需要集成第三方库、插件或者广告代码。这些代码可能存在安全隐患，如恶意代码、XSS 攻击等。使用前端沙盒技术，我们可以在隔离的环境中执行这些不受信任的代码，降低安全风险。</p>
</li>
<li><p>用户自定义代码执行<br>在一些在线编程平台、教育工具或者可视化编辑器中，用户可能需要编写并执行自定义的 JavaScript 代码。前端沙盒可以为用户提供一个安全的代码执行环境，防止恶意代码对应用程序或其他用户数据造成破坏。</p>
</li>
<li><p>多租户应用<br>在多租户应用中，不同租户的代码可能需要在同一个浏览器环境中运行，但又需要相互隔离以保护数据安全。前端沙盒技术可以为每个租户创建独立的执行环境，确保数据和资源的隔离。</p>
</li>
<li><p>性能隔离<br>在复杂的 Web 应用中，某些耗时的任务可能会影响到页面的性能和响应速度。使用前端沙盒技术，如 Web Workers，可以将这些任务放在后台线程中执行，避免阻塞主线程，提高页面性能。</p>
</li>
<li><p>代码审计和测试<br>在代码审计和测试过程中，我们可能需要执行一些不确定的代码片段。使用前端沙盒技术可以确保这些代码在一个受限制的环境中运行，防止对应用程序或系统造成意外损害。</p>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><h3 id="使用-iframe"><a href="#使用-iframe" class="headerlink" title="使用 iframe"></a>使用 iframe</h3><p>iframe 是一种内嵌 HTML 文档的方式，可以用于创建于一个独立的、隔离的浏览器上下文。我们可以利用 iframe 实现前端沙盒。<br>1、创建和配置 iframe<br>使用<code>document.createElemet</code>创建 iframe 元素，并设置其属性和样式，以便将其嵌入到我们的应用程序中。</p>
<p>2、限制 iframe 的权限<br>使用<code>sandbox</code>属性限制 iframe 的权限选项</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>属性值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>allow-form</td>
<td>允许表单提交</td>
</tr>
<tr>
<td>allow-modals</td>
<td>允许弹出窗口，如<code>alert</code>、<code>confirm</code>、<code>prompt</code></td>
</tr>
<tr>
<td>allow-oriential-lock</td>
<td>允许锁定屏幕方向</td>
</tr>
<tr>
<td>all-pointer-lock</td>
<td>允许指针锁定</td>
</tr>
<tr>
<td>allow-popups</td>
<td>允许弹出窗口。</td>
</tr>
<tr>
<td>allow-popups-to-escape-sandbox</td>
<td>允许沙盒外的弹出窗口。</td>
</tr>
<tr>
<td>allow-presentation</td>
<td>允许演示请求。</td>
</tr>
<tr>
<td>allow-same-origin</td>
<td>允许同源策略，使 iframe 可以访问父页面的 DOM。</td>
</tr>
<tr>
<td>allow-scripts</td>
<td>允许执行脚本。</td>
</tr>
<tr>
<td>allow-top-navigation</td>
<td>允许 iframe 导航到其父页面。</td>
</tr>
<tr>
<td>allow-top-navigation-by-user-activation</td>
<td>允许用户激活的 iframe 导航到其父页面。</td>
</tr>
</tbody></table>
<p>3、加载网络请求返回代码</p>
<p>使用 iframe 的<code>srcdoc</code>属性或<code>src</code>属性加载网络请求返回的代码，并对其进行验证和过滤，以防止恶意代码的执行</p>
<p>4、与 iframe 进行通信</p>
<p>使用<code>postMessage</code>方法进行消息传递，以便在主页面和 iframe 之间建立通信通道</p>
<p>示例如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">class IframeSandbox &#123;</span><br><span class="line">  constructor(options) &#123;</span><br><span class="line">    this.options = options || &#123;&#125;;</span><br><span class="line">    this.iframe = document.createElement(&#x27;iframe&#x27;);</span><br><span class="line">    this.init();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  init() &#123;</span><br><span class="line">    this.setupIframe();</span><br><span class="line">    this.setupMessageListener();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  setupIframe() &#123;</span><br><span class="line">    const &#123; width, height, sandboxAttributes &#125; = this.options;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    this.iframe.width = width || &#x27;100%&#x27;;</span><br><span class="line">    this.iframe.height = height || &#x27;100%&#x27;;</span><br><span class="line">    this.iframe.sandbox = sandboxAttributes || &#x27;allow-scripts&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    document.body.appendChild(this.iframe);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  setupMessageListener() &#123;</span><br><span class="line">    window.addEventListener(&#x27;message&#x27;, (event) =&gt; &#123;</span><br><span class="line">      if (event.source === this.iframe.contentWindow) &#123;</span><br><span class="line">        console.log(&#x27;Message from iframe:&#x27;, event.data);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  executeCode(code) &#123;</span><br><span class="line">   const disableFetchAndXHR = `</span><br><span class="line">      &lt;script&gt;</span><br><span class="line">        window.fetch = function() &#123;</span><br><span class="line">          throw new Error(&#x27;Fetch is not allowed in this sandbox.&#x27;);</span><br><span class="line">        &#125;;</span><br><span class="line">        window.XMLHttpRequest = function() &#123;</span><br><span class="line">          throw new Error(&#x27;XMLHttpRequest is not allowed in this sandbox.&#x27;);</span><br><span class="line">        &#125;;</span><br><span class="line">      &lt;/script&gt;</span><br><span class="line">    `;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    const html = `</span><br><span class="line">      &lt;!DOCTYPE html&gt;</span><br><span class="line">      &lt;html&gt;</span><br><span class="line">      &lt;head&gt;</span><br><span class="line">        $&#123;disableFetchAndXHR&#125;</span><br><span class="line">      &lt;/head&gt;</span><br><span class="line">      &lt;body&gt;</span><br><span class="line">        $&#123;code&#125;</span><br><span class="line">      &lt;/body&gt;</span><br><span class="line">      &lt;/html&gt;</span><br><span class="line">    `;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    const codeBlob = new Blob([html], &#123; type: &#x27;text/html&#x27; &#125;);</span><br><span class="line">    const codeUrl = URL.createObjectURL(codeBlob);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    this.iframe.src = codeUrl;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  postMessage(message) &#123;</span><br><span class="line">    this.iframe.contentWindow.postMessage(message, &#x27;*&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 使用示例</span><br><span class="line">const iframeSandbox = new IframeSandbox(&#123;</span><br><span class="line">  width: &#x27;500px&#x27;,</span><br><span class="line">  height: &#x27;300px&#x27;,</span><br><span class="line">  sandboxAttributes: &#x27;allow-scripts&#x27;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const code = `</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    window.addEventListener(&#x27;message&#x27;, (event) =&gt; &#123;</span><br><span class="line">      console.log(&#x27;Message from parent:&#x27;, event.data);</span><br><span class="line">      event.source.postMessage(&#x27;Hello from iframe!&#x27;, &#x27;*&#x27;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">iframeSandbox.executeCode(code);</span><br><span class="line">iframeSandbox.postMessage(&#x27;Hello from parent!&#x27;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里定义了一个名为 IframeSandbox 的类，它可以用于创建基于 iframe 的沙盒环境。在类的构造函数中，我们创建一个 iframe 元素，并进行一些初始化操作，如设置 iframe 的尺寸、权限等。我们还为主页面添加了一个消息监听器，用于接收来自 iframe 的消息。</p>
<p>此外，我们定义了两个方法：executeCode 和 postMessage。executeCode 方法用于在 iframe 中执行给定的代码，我们在 executeCode 方法中添加了一个名为 disableFetchAndXHR 的变量，其中包含用于禁用 fetch 和 XMLHttpRequest API 的脚本。然后，我们将这段脚本插入到要加载到 iframe 中的 HTML 字符串中。这样，在 iframe 中执行的任何代码都无法使用 fetch 和 XMLHttpRequest API。而 postMessage 方法用于向 iframe 发送消息。在使用示例中，我们创建了一个 IframeSandbox 实例，并执行了一段简单的代码，该代码在 iframe 中监听来自主页面的消息，并回复一条消息。</p>
<p>需要注意的是，这种方法仅适用于你对 iframe 中的内容有完全控制的情况。如果你需要加载外部 URL，并且无法修改其内容，这种方法可能无法实现。在这种情况下，你可以考虑使用其他沙盒技术，如 Web Workers，或者在服务端对网络请求进行控制和过滤。</p>
<h3 id="使用-Web-Workers"><a href="#使用-Web-Workers" class="headerlink" title="使用 Web Workers"></a>使用 Web Workers</h3><p>Web Workers 是一种在后台线程中运行 JavaScript 代码的技术，可以用于实现前端沙盒</p>
<ul>
<li><p>创建 Web Workers<br>使用<code>new Worker()</code>构造函数创建 Web Worker 实例，并将<br>网络请求返回的代码作为参数传递给构造函数。</p>
</li>
<li><p>限制 Web Workers 的权限<br>Web Workers 默认在沙盒环境中运行，无法访问 DOM</p>
</li>
<li><p>与 Web Worker 进行通信<br>使用<code>postMessage</code>方法进行消息传递，以便在主页面和 Web Worker 之间建立通信通道。</p>
</li>
</ul>
<p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">class WebWorkerSandbox &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    this.worker = null;</span><br><span class="line">    this.init();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  init() &#123;</span><br><span class="line">    this.setupMessageListener();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  setupMessageListener() &#123;</span><br><span class="line">    this.messageHandler = (event) =&gt; &#123;</span><br><span class="line">      console.log(&#x27;Message from Web Worker:&#x27;, event.data);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  executeCode(code) &#123;</span><br><span class="line">    const codeBlob = new Blob([code], &#123; type: &#x27;text/javascript&#x27; &#125;);</span><br><span class="line">    const codeUrl = URL.createObjectURL(codeBlob);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    if (this.worker) &#123;</span><br><span class="line">      this.worker.terminate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    this.worker = new Worker(codeUrl);</span><br><span class="line">    this.worker.addEventListener(&#x27;message&#x27;, this.messageHandler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  postMessage(message) &#123;</span><br><span class="line">    if (this.worker) &#123;</span><br><span class="line">      this.worker.postMessage(message);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      console.error(&#x27;Web Worker is not initialized.&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  terminate() &#123;</span><br><span class="line">    if (this.worker) &#123;</span><br><span class="line">      this.worker.terminate();</span><br><span class="line">      this.worker = null;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 使用示例</span><br><span class="line">const webWorkerSandbox = new WebWorkerSandbox();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const code = `</span><br><span class="line">  self.addEventListener(&#x27;message&#x27;, (event) =&gt; &#123;</span><br><span class="line">    console.log(&#x27;Message from parent:&#x27;, event.data);</span><br><span class="line">    self.postMessage(&#x27;Hello from Web Worker!&#x27;);</span><br><span class="line">  &#125;);</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">webWorkerSandbox.executeCode(code);</span><br><span class="line">webWorkerSandbox.postMessage(&#x27;Hello from parent!&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 释放资源</span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  webWorkerSandbox.terminate();</span><br><span class="line">&#125;, 5000);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里 定义了一个名为 WebWorkerSandbox 的类，用于创建基于 Web Workers 的沙盒环境。在类的构造函数中，我们进行一些初始化操作，如设置消息监听器。</p>
<p>我们定义了四个方法：executeCode、postMessage、terminate 和 setupMessageListener。executeCode 方法用于在 Web Worker 中执行给定的代码，postMessage 方法用于向 Web Worker 发送消息，terminate 方法用于终止 Web Worker，setupMessageListener 方法用于设置消息监听器。</p>
<p>在使用示例中，我们创建了一个 WebWorkerSandbox 实例，并执行了一段简单的代码，该代码在 Web Worker 中监听来自主页面的消息，并回复一条消息。我们还演示了如何终止 Web Worker 以释放资源。</p>
<h2 id="方案对比"><a href="#方案对比" class="headerlink" title="方案对比"></a>方案对比</h2><table>
<thead>
<tr>
<th>特性</th>
<th>iframe</th>
<th>Web Worker</th>
</tr>
</thead>
<tbody><tr>
<td>环境</td>
<td>完整的浏览器环境（包括 DOM、CSS 和 JavaScript）</td>
<td>独立的 JavaScript 执行环境（无 DOM 和 CSS）</td>
</tr>
<tr>
<td>访问权限</td>
<td>可访问 DOM 和浏览器相关 API</td>
<td>无法访问 DOM 和浏览器相关 API</td>
</tr>
<tr>
<td>隔离性</td>
<td>有限的隔离性，可以通过设置 <code>allow-same-origin</code> 访问主页面 DOM</td>
<td>高度隔离，无法访问主页面 DOM 和数据</td>
</tr>
<tr>
<td>通信</td>
<td>使用<code>postMessage</code>方法进行跨域消息传递</td>
<td>使用<code>postMessage</code>方法进行跨域消息传递</td>
</tr>
<tr>
<td>性能</td>
<td>可能影响性能，尤其是在存在多个 iframe 时</td>
<td>运行在后台线程中，不会阻塞主线程，性能更优</td>
</tr>
</tbody></table>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>如果你需要一个完整的浏览器环境来渲染和执行 HTML、CSS 和 JavaScript 代码，那么 iframe 更适合你。</li>
<li>如果你只需要一个独立的 JavaScript 执行环境，而不需要访问 DOM 和浏览器相关 API，那么 Web Worker 更适合你。</li>
<li>在性能方面，Web Worker 通常比 iframe 更优越，因为它运行在后台线程中，不会阻塞主线程。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/git%E4%BD%BF%E7%94%A8ssh%E8%BF%9E%E6%8E%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/git%E4%BD%BF%E7%94%A8ssh%E8%BF%9E%E6%8E%A5/" class="post-title-link" itemprop="url">Git使用ssh连接</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/Git/" itemprop="url" rel="index"><span itemprop="name">Git</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="不存在-SSH-秘钥"><a href="#不存在-SSH-秘钥" class="headerlink" title="不存在 SSH 秘钥"></a>不存在 SSH 秘钥</h2><ul>
<li>打开 github-&gt;setting-&gt;sshkeys and GPGkeys</li>
<li>输入 ssh-keygen -t rsa -C “<a href="mailto:&#x78;&#x78;&#x78;&#120;&#x40;&#120;&#120;&#x78;&#46;&#x63;&#111;&#x6d;">&#x78;&#x78;&#x78;&#120;&#x40;&#120;&#120;&#x78;&#46;&#x63;&#111;&#x6d;</a>“(你的邮箱)</li>
<li>cat ~&#x2F;.ssh&#x2F;id_rsa.pub</li>
<li>复制产生的 ssh keys，并粘贴到 github 对应页面位置中</li>
</ul>
<h2 id="ssh-keys-过期失效"><a href="#ssh-keys-过期失效" class="headerlink" title="ssh keys 过期失效"></a>ssh keys 过期失效</h2><ul>
<li>检查 SSH keys 是否已经存在<ul>
<li><code>ls ~/.ssh/</code></li>
</ul>
</li>
<li>将获取的 SSH Keys 添加到 id_rsa<ul>
<li><code>ssh-agent bash</code></li>
<li><code>ssh-add ~/.ssh/id_rsa</code></li>
</ul>
</li>
<li>测试是否链接成功<ul>
<li><code>ssh -T git@github.com</code></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Luzy</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
