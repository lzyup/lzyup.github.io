<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yoursite.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Luzy&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Luzy&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Luzy">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://yoursite.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Luzy's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Luzy's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Luzy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/11/cookie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/11/cookie/" class="post-title-link" itemprop="url">cookie</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-11 14:17:06" itemprop="dateCreated datePublished" datetime="2024-09-11T14:17:06+08:00">2024-09-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-13 15:30:26" itemprop="dateModified" datetime="2024-09-13T15:30:26+08:00">2024-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C/cookie/" itemprop="url" rel="index"><span itemprop="name">cookie</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1、Cookie是什么"><a href="#1、Cookie是什么" class="headerlink" title="1、Cookie是什么"></a>1、Cookie是什么</h2><p>HTTP Cookie（也叫 Web Cookie 或浏览器 Cookie）是服务器发送到用户浏览器并保存在本地的一小块数据。浏览器会存储 cookie<code> 并在下次向同一服务器再发起请求时携带并发送到服务器上</code></p>
<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><h3 id="一、-Domain、Path"><a href="#一、-Domain、Path" class="headerlink" title="一、 Domain、Path"></a>一、 <code>Domain</code>、<code>Path</code></h3><p>这两个字段定义了Cookie的作用域：即允许Cookie应该发送给哪些URL</p>
<h3 id="二、Secure、HttpOnly"><a href="#二、Secure、HttpOnly" class="headerlink" title="二、Secure、HttpOnly"></a>二、<code>Secure</code>、<code>HttpOnly</code></h3><ul>
<li>标记为 Secure 的 Cookie 只应通过被 HTTPS 协议加密过的请求发送给服务端</li>
<li>JavaScript的Document.cookie API 无法访问带有 HttpOnly 属性的 cookie；此类 Cookie 仅作用于服务器。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="三、SameSite"><a href="#三、SameSite" class="headerlink" title="三、SameSite"></a>三、<code>SameSite</code></h3><p>SameSite 控制cookie是否与跨站点请求一起发送(可以让 Cookie 在跨站请求时不会被发送)</p>
<ul>
<li>Strict<br>当跨站时，发送请求不会带上 第三方Cookie。仅当与当前页面属于同个站点时，才会携带 Cookie。</li>
<li>Lax<br>允许部分跨站请求携带 Cookie。但仅在以下几种情况</li>
</ul>
<table>
<thead>
<tr>
<th>请求类型</th>
<th>示例</th>
<th>是否发送</th>
</tr>
</thead>
<tbody><tr>
<td>链接</td>
<td><code> &lt;a href=&quot;xxx&quot;&gt;&lt;/a&gt;</code></td>
<td>是</td>
</tr>
<tr>
<td>Paragraph</td>
<td><code>&lt;link rel=&quot;prerender&quot; href=&quot;xxx&quot; /&gt;</code></td>
<td>是</td>
</tr>
<tr>
<td>GET 表单</td>
<td><code>&lt;form method=&quot;GET&quot; action=&quot;xxx&quot;&gt;	</code></td>
<td>是</td>
</tr>
</tbody></table>
<ul>
<li>None<br>允许任意站点请求携带 Cookie。但是需要额外带上 Secure 属性。</li>
</ul>
<h2 id="跨站"><a href="#跨站" class="headerlink" title="跨站"></a>跨站</h2><p>判断是否是同站的条件</p>
<ul>
<li>eTLD + 1一致</li>
</ul>
<p>相比较于同源，同站会更简单。并不要求协议、域名和端口都要一致，只要 eTLD + 1 一致就可以了。</p>
<h3 id="effective-TLDS"><a href="#effective-TLDS" class="headerlink" title="effective TLDS"></a>effective TLDS</h3><p>Top-Level-Domain(TLD) 即顶级域名，例如 .com、.org 等。我们所说的 “站” 就是 domain + TLD 组成的部分。当两个站点的 “站” 相同时，我们就可以认为两个站属于同站。 但对于 .github.io 这样的站点，使用 .io 并不足以识别 “站”， effective TLDS 由此产生，即有效的顶级域名。对于 <a href="https://www.example.com/">https://www.example.com</a> 来说，eTLD + 1 就是 example.com。对于 <a href="https://a.b.github.io/">https://a.b.github.io</a> 来说，eTLD + 1 就是 b.github.io 。</p>
<h3 id="第一方Cookie和第三方Cookie"><a href="#第一方Cookie和第三方Cookie" class="headerlink" title="第一方Cookie和第三方Cookie"></a>第一方Cookie和第三方Cookie</h3><ul>
<li><p>第一方cookie由你访问的站点创建。该站点指的是地址栏显示的站点；</p>
</li>
<li><p>第三方cookie是由其他站点创建的。这些站点拥有你当前访问的网页上部分资源，如广告或图像。</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/" class="post-title-link" itemprop="url">前端性能监控</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%9B%91%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">监控</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%9B%91%E6%8E%A7/%E5%8E%9F%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">原理</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h2><h3 id="错误监控"><a href="#错误监控" class="headerlink" title="错误监控"></a>错误监控</h3><ul>
<li>JS 执行错误<br>要捕获 JS 的运行时错误，只需要监听<code>onerror</code>事件。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">window.onerror = (...args) =&gt; &#123;</span><br><span class="line">  this.publishErrorLog(&#123;</span><br><span class="line">    msg: `$&#123;stringifyPlus(args[0]) || &#x27;&#x27;&#125; @ ($&#123;stringifyPlus(args[1]) || &#x27;&#x27;&#125;:$&#123;args[2] || 0</span><br><span class="line">    &#125;:$&#123;args[3] || 0&#125;)</span><br><span class="line">    \n$&#123;stringifyPlus(args[4] || &#x27;&#x27;)&#125;`,</span><br><span class="line">    level: LogType.ERROR,</span><br><span class="line">  &#125;);</span><br><span class="line">  orgError?.call(window, ...args);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>promise 执行错误<br>要捕获没有被用户 catch 的 promise 错误，可以通过监听<code>unhandlerjection</code>事件实现</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&#x27;unhandledrejection&#x27;, (event: PromiseRejectionEvent) =&gt; &#123;</span><br><span class="line">  const reason = event &amp;&amp; stringifyPlus(event.reason);</span><br><span class="line">  this.publishErrorLog(&#123;</span><br><span class="line">    msg: `PROMISE_ERROR: $&#123;reason&#125;`,</span><br><span class="line">    level: LogType.PROMISE_ERROR,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;);</span><br></pre></td></tr></table></figure>

<ul>
<li>资源加载失败<br>只要监听<code>error</code>事件就能获取到资源加载失败的信息<br>当资源（如 img 或 script）加载失败，加载资源的元素会触发一个 Event 接口的 error 事件，并执行该元素上的 onerror()处理函数。这些 error 事件不会向上冒泡到 window，但可以在捕获阶段被捕获<br>因此如果要全局监听资源加载错误，需要在捕获阶段捕获事件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">window.document.addEventListener(&#x27;error&#x27;, (event: Event) =&gt; &#123;</span><br><span class="line">  const target = event?.target || event?.srcElement;</span><br><span class="line">  const url = target.src || target.href;</span><br><span class="line">  const &#123; tagName &#125; = target;</span><br><span class="line"></span><br><span class="line">  if (typeof url === &#x27;string&#x27; &amp;&amp; tagName) &#123;</span><br><span class="line">    const log: NormalLog = &#123;</span><br><span class="line">      msg: `$&#123;tagName&#125; load fail: $&#123;url&#125;`,</span><br><span class="line">      level: LogType.INFO,</span><br><span class="line">    &#125;;</span><br><span class="line">    // 先根据文件后缀简单判断</span><br><span class="line">    if (/\.js$/.test(url)) &#123;</span><br><span class="line">      log.level = LogType.SCRIPT_ERROR;</span><br><span class="line">    &#125; else if (/\.css$/.test(url)) &#123;</span><br><span class="line">      log.level = LogType.CSS_ERROR;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // 再根据文件类型判断</span><br><span class="line">      switch (tagName.toLowerCase()) &#123;</span><br><span class="line">        case &#x27;script&#x27;:</span><br><span class="line">          log.level = LogType.SCRIPT_ERROR;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;link&#x27;:</span><br><span class="line">          log.level = LogType.CSS_ERROR;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;img&#x27;:</span><br><span class="line">          log.level = LogType.IMAGE_ERROR;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;audio&#x27;:</span><br><span class="line">        case &#x27;video&#x27;:</span><br><span class="line">          log.level = LogType.MEDIA_ERROR;</span><br><span class="line">          break;</span><br><span class="line">        default:</span><br><span class="line">          return;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    this.publishErrorLog(log);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, true);</span><br></pre></td></tr></table></figure>

<ul>
<li>接口请求异常<br>要获取接口请求的异常，需要劫持<code>XMLHttpRequest</code>和<code>fetch</code>这 2 个浏览器 API，在请求返回的时候判断是否有错误</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * XMLHttpRequest 劫持</span><br><span class="line"> */</span><br><span class="line">xhr.addEventListener(&#x27;timeout&#x27;, () =&gt; &#123;</span><br><span class="line">  xhr.failType = &#x27;timeout&#x27;;</span><br><span class="line">&#125;);</span><br><span class="line">xhr.addEventListener(&#x27;error&#x27;, () =&gt; &#123;</span><br><span class="line">  xhr.failType = &#x27;error&#x27;;</span><br><span class="line">&#125;);</span><br><span class="line">xhr.addEventListener(&#x27;abort&#x27;, () =&gt; &#123;</span><br><span class="line">  xhr.failType = &#x27;abort&#x27;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">xhr.addEventListener(&#x27;loadend&#x27;, function aegisXhrLoadendHandler() &#123;</span><br><span class="line">  let type = &#x27;&#x27;;</span><br><span class="line">  if (this.failType) &#123;</span><br><span class="line">    type = this.failType;</span><br><span class="line">  &#125; else if (!this.status) &#123; // status 为 0 或者 undefined</span><br><span class="line">    type = &#x27;failed&#x27;;</span><br><span class="line">  &#125; else if (this.status &gt;= 400) &#123;</span><br><span class="line">    type = &#x27;error&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (type) &#123;</span><br><span class="line">    const url = xhr.aegisUrl;</span><br><span class="line">    const &#123; code &#125; = tryToGetRetCode(xhr.response, aegis.config.api, &#123; url, ctx: xhr &#125;);</span><br><span class="line">    self.publishErrorLog(&#123;</span><br><span class="line">      msg: `AJAX_ERROR: request $&#123;type&#125;</span><br><span class="line">            \nreq url: $&#123;this.aegisUrl&#125;</span><br><span class="line">            \nres status: $&#123;this.status || 0&#125;</span><br><span class="line">            \nres retcode: $&#123;code&#125;</span><br><span class="line">            \nres duration: $&#123;Date.now() - xhr.aegisXhrStartTime&#125;ms</span><br><span class="line">            \nreq method: $&#123;this.aegisMethod&#125;</span><br><span class="line">            \nreq param: $&#123;apiDetail ? stringifyObj(body) : &#x27;&#x27;&#125;</span><br><span class="line">            \nres data: $&#123;apiDetail ? readBody(xhr)?.slice(0, 1000) : &#x27;&#x27;&#125;`,</span><br><span class="line">      level: LogType.AJAX_ERROR,</span><br><span class="line">      ctx: xhr,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * fetch 劫持</span><br><span class="line"> */</span><br><span class="line">then: (res, duration, url, option) =&gt; &#123;</span><br><span class="line">  const isAjaxError = res.status &lt;= 0 || res.status &gt;= 400;</span><br><span class="line">  const apiDetail = config.api?.apiDetail;</span><br><span class="line"></span><br><span class="line">  const &#123; code, isErr &#125; = tryToGetRetCode(data, config.api, &#123; url, ctx: res &#125;);</span><br><span class="line">  const apiDesc = `$&#123;isAjaxError ? `FETCH_ERROR: $&#123;data&#125; \n\n` : &#x27;&#x27;&#125;req url: $&#123;url&#125;</span><br><span class="line">                  \nreq method: $&#123;option?.method || &#x27;get&#x27;&#125;</span><br><span class="line">                  \nreq param: $&#123;apiDetail ? stringifyObj(option?.body) : &#x27;&#x27;&#125;</span><br><span class="line">                  \nres duration: $&#123;duration&#125;ms</span><br><span class="line">                  \nres status: $&#123;res.status || 0&#125;</span><br><span class="line">                  \nres retcode: $&#123;code&#125;</span><br><span class="line">                  \nres data: $&#123;apiDetail ? data : &#x27;&#x27;&#125;`;</span><br><span class="line">  // 上报retcode错误日志</span><br><span class="line">  this.publishNormalLog(&#123;</span><br><span class="line">    msg: apiDesc,</span><br><span class="line">    // eslint-disable-next-line no-nested-ternary</span><br><span class="line">    level: isAjaxError ? LogType.AJAX_ERROR : (isErr ? LogType.RET_ERROR : LogType.API_RESPONSE),</span><br><span class="line">    code,</span><br><span class="line">    ctx: res,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">catch: (err, duration, url, option) =&gt; &#123;</span><br><span class="line">  const apiDetail = config.api?.apiDetail;</span><br><span class="line">  // 发生错误：跨域、链接有错</span><br><span class="line">  const apiDesc = `AJAX_ERROR: $&#123;err&#125;</span><br><span class="line">                  \nres status: 0</span><br><span class="line">                  \nres duration: $&#123;duration&#125;ms</span><br><span class="line">                  \nreq url: $&#123;url&#125;</span><br><span class="line">                  \nreq method: $&#123;option?.method || &#x27;get&#x27;&#125;</span><br><span class="line">                  \nreq param: $&#123;apiDetail ? stringifyObj(option?.body) : &#x27;&#x27;&#125;`;</span><br><span class="line">  // 上报接口错误数据</span><br><span class="line">  this.publishNormalLog(&#123;</span><br><span class="line">    msg: apiDesc,</span><br><span class="line">    level: LogType.AJAX_ERROR,</span><br><span class="line">    code: -400,</span><br><span class="line">    ctx: err,</span><br><span class="line">  &#125;);</span><br><span class="line">  // 原封不动继续抛出err</span><br><span class="line">  throw err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="性能监控"><a href="#性能监控" class="headerlink" title="性能监控"></a>性能监控</h3><ul>
<li>页面测速<br>9 大性能指标 - DNS 查询 - TCP 连接 - SSL 建连 - 请求响应 - 内容传输 - DOM 解析 - 资源加载 - 首屏耗时 - 页面完成时间耗时<br>前七个可以直接调用 Performance API 算出来的</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const t: PerformanceTiming = performance.timing;</span><br><span class="line">const result = &#123;</span><br><span class="line">  dnsLookup: t.domainLookupEnd - t.domainLookupStart,</span><br><span class="line">  tcp: t.connectEnd - t.connectStart,</span><br><span class="line">  ssl: t.secureConnectionStart === 0 ? 0 : t.requestStart - t.secureConnectionStart,</span><br><span class="line">  ttfb: t.responseStart - t.requestStart,</span><br><span class="line">  contentDownload: t.responseEnd - t.responseStart,</span><br><span class="line">  domParse: t.domInteractive - t.domLoading,</span><br><span class="line">  resourceDownload: t.loadEventStart - t.domInteractive,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>接口测速</li>
<li>资源测速</li>
<li>Web Vitals</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/%E5%8F%91%E5%B8%83npm%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/%E5%8F%91%E5%B8%83npm%E5%8C%85/" class="post-title-link" itemprop="url">发布npm包</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/npm/" itemprop="url" rel="index"><span itemprop="name">npm</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="1、npm相关命令"><a href="#1、npm相关命令" class="headerlink" title="1、npm相关命令"></a>1、<code>npm</code>相关命令</h3><ul>
<li><p>查看 npm 镜像源地址</p>
<p><code>npm config get registry</code></p>
</li>
<li><p>设置 npm 默认源</p>
<p><code>npm config set registry https://registry.npmmirror.com</code></p>
</li>
<li><p>注册用户(按照提示输入 Username、Password、Email 完成注册)</p>
<p><code>npm adduser</code></p>
</li>
<li><p>登录</p>
<p><code>npm login</code></p>
</li>
<li><p>发布包</p>
<p><code>npm publish</code></p>
</li>
<li><p>升级版本</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm version patch   (补丁号，修复bug ， v1.0.0----&gt;v1.0.1)</span><br><span class="line"></span><br><span class="line">npm version minor   (次版本号，增加新功能，v1.0.0----&gt;v1.1.0)</span><br><span class="line"></span><br><span class="line">npm version major    (主版本号，不兼容的修改，v1.0.0----&gt;v2.0.0)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>撤销发布的包</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm unpublish z-tool@1.0.0 删除某个版本</span><br><span class="line">npm unpublish z-tool --force 删除整个npm市场的包</span><br><span class="line"></span><br><span class="line">npm unpublish的推荐替代命令：npm deprecate &lt;pkg&gt;[@&lt;version&gt;] &lt;message&gt;</span><br><span class="line">使用这个命令，并不会在社区里撤销你已有的包，但会在任何人尝试安装这个包的时候得到警告</span><br><span class="line">例如：npm deprecate z-tool &#x27;这个包我已经不再维护了哟～&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2、文件说明"><a href="#2、文件说明" class="headerlink" title="2、文件说明"></a>2、文件说明</h3><h4 id="2-1vite-config-ts配置如下"><a href="#2-1vite-config-ts配置如下" class="headerlink" title="2.1vite.config.ts配置如下"></a>2.1<code>vite.config.ts</code>配置如下</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/* eslint-disable @typescript-eslint/ban-ts-comment */</span><br><span class="line">import &#123; defineConfig &#125; from &#x27;vite&#x27;;</span><br><span class="line">import react from &#x27;@vitejs/plugin-react&#x27;;</span><br><span class="line">import dts from &#x27;vite-plugin-dts&#x27;;</span><br><span class="line">// @ts-ignore</span><br><span class="line">import &#123; resolve &#125; from &#x27;path&#x27;;</span><br><span class="line"></span><br><span class="line">// https://vitejs.dev/config/</span><br><span class="line">export default defineConfig(&#123;</span><br><span class="line">  build: &#123;</span><br><span class="line">    outDir: &#x27;lib&#x27;, // 自定义构建输出目录</span><br><span class="line">    lib: &#123;</span><br><span class="line">      // @ts-expect-error</span><br><span class="line">      entry: resolve(__dirname, &#x27;src/index.ts&#x27;),</span><br><span class="line">      name: &#x27;index&#x27;,</span><br><span class="line">      fileName: &#x27;index&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    cssCodeSplit: false, // 避免打包时出现</span><br><span class="line">    rollupOptions: &#123;</span><br><span class="line">      // 确保外部化处理那些你不想打包进库的依赖</span><br><span class="line">      external: [&#x27;react&#x27;, &#x27;react-dom&#x27;],</span><br><span class="line">      output: &#123;</span><br><span class="line">        // 在 UMD 构建模式下为这些外部化的依赖提供一个全局变量</span><br><span class="line">        globals: &#123;</span><br><span class="line">          vue: &#x27;React&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [react(), dts()],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用<code>vite-plugin-dts</code>插件，用于自动生成 TypeScript 类型定义文件（.d.ts）</p>
<h3 id="2-2-包的导出"><a href="#2-2-包的导出" class="headerlink" title="2.2 包的导出"></a>2.2 包的导出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export &#123; SequenceDiagrams &#125; from &#x27;./components/index&#x27;;</span><br><span class="line"></span><br><span class="line">export &#123; TaskType, TaskStatus &#125; from &#x27;./components/type&#x27;;</span><br><span class="line">export type &#123; ITaskItem, IRoleItem &#125; from &#x27;./components/type&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<code>index.ts</code>导出组件和对应的类型</p>
<h3 id="2-3-package-json-关键字段说明"><a href="#2-3-package-json-关键字段说明" class="headerlink" title="2.3 package.json 关键字段说明"></a>2.3 package.json 关键字段说明</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;@luzyup/sequence-diagram&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;0.0.4&quot;,</span><br><span class="line">  &quot;type&quot;: &quot;module&quot;,</span><br><span class="line">  &quot;types&quot;: &quot;./lib/index.d.ts&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;./lib/index.umd.cjs&quot;,</span><br><span class="line">  &quot;module&quot;: &quot;./lib/index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;dev&quot;: &quot;vite&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;tsc &amp;&amp; vite build&quot;,</span><br><span class="line">    &quot;lint&quot;: &quot;eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0&quot;,</span><br><span class="line">    &quot;preview&quot;: &quot;vite preview&quot;,</span><br><span class="line">    &quot;docs:dev&quot;: &quot;vitepress dev docs&quot;,</span><br><span class="line">    &quot;docs:build&quot;: &quot;vitepress build docs&quot;,</span><br><span class="line">    &quot;docs:preview&quot;: &quot;vitepress preview docs&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;@ant-design/icons&quot;: &quot;^5.3.7&quot;,</span><br><span class="line">    &quot;ahooks&quot;: &quot;^3.8.0&quot;,</span><br><span class="line">    &quot;antd&quot;: &quot;^5.18.1&quot;,</span><br><span class="line">    &quot;react&quot;: &quot;^18.2.0&quot;,</span><br><span class="line">    &quot;react-dom&quot;: &quot;^18.2.0&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;@types/react&quot;: &quot;^18.2.66&quot;,</span><br><span class="line">    &quot;@types/react-dom&quot;: &quot;^18.2.22&quot;,</span><br><span class="line">    &quot;@typescript-eslint/eslint-plugin&quot;: &quot;^7.2.0&quot;,</span><br><span class="line">    &quot;@typescript-eslint/parser&quot;: &quot;^7.2.0&quot;,</span><br><span class="line">    &quot;@vitejs/plugin-react&quot;: &quot;^4.2.1&quot;,</span><br><span class="line">    &quot;eslint&quot;: &quot;^8.57.0&quot;,</span><br><span class="line">    &quot;eslint-plugin-react-hooks&quot;: &quot;^4.6.0&quot;,</span><br><span class="line">    &quot;eslint-plugin-react-refresh&quot;: &quot;^0.4.6&quot;,</span><br><span class="line">    &quot;less&quot;: &quot;^4.2.0&quot;,</span><br><span class="line">    &quot;typescript&quot;: &quot;^5.2.2&quot;,</span><br><span class="line">    &quot;vite&quot;: &quot;^5.2.0&quot;,</span><br><span class="line">    &quot;vite-plugin-dts&quot;: &quot;^3.9.1&quot;,</span><br><span class="line">    &quot;vitepress&quot;: &quot;^1.2.3&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>type</code></li>
</ul>
<p>指定项目的类型，可以是<code>module</code>或<code>commonjs</code>，用于告诉 Node.js 如何解析模块。如果不指定 type 字段，默认为”commonjs”。如果使用 ES 模块语法，应该将 type 设置为”module”</p>
<ul>
<li><code>types</code></li>
</ul>
<p>指定项目的类型定义文件(.d.ts)的路径，用于 TypeScript 中引用项目的类型定义。如果项目没有类型定义文件，可以通过<code>vite-plugin-dts</code>等工具自动生成</p>
<ul>
<li><code>main</code></li>
</ul>
<p>指定项目的入口文件路径，用于 require()或者 import 项目时默认加载的文件。如果不指定 main 字段，默认为”index.js”。</p>
<ul>
<li><code>module</code><br>指定 ES 模块规范下的入口文件路径，用于 import 项目时默认加载的文件。如果不指定 module 字段，默认为”index.js”。如果项目使用 ES 模块语法，应该同时指定 main 和 module 字段</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">发布订阅模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">响应式原理</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>发布-订阅模式又叫做观察者模式，它定义了一种一对多的依赖关系，即当一个对象的状态发生改变的时候，所有依赖他的对象都会得到通知。</p>
<h3 id="观察者模式下的角色划分"><a href="#观察者模式下的角色划分" class="headerlink" title="观察者模式下的角色划分"></a>观察者模式下的角色划分</h3><ul>
<li><code>Subject</code>:抽象主题（抽象被观察者），抽象主题角色把所有观察者对象保存在一个集合里，每个主题都可以有任意数量的观察者，抽象主题提供一个接口，可以增加和删除观察者对象</li>
<li><code>ConcreteSubject</code>:具体主题（具体被观察者），该角色将有关状态存入具体观察者对象，在具体主题的内部状态发生改变时，给所有注册过的观察者发送通知。</li>
<li><code>Observer</code>：抽象观察者，是观察者的抽象类，它定义一个更新接口，使得在得到主题更改通知时更新自己。</li>
<li><code>ConcreteObserver</code>：具体观察者，实现抽象观察者定义的更新接口，以便在得到主题更改通知时更新自身的状态。</li>
</ul>
<p><a href="https://blog.csdn.net/itachi85/article/details/50773358">参考链接</a></p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function Dep()&#123;</span><br><span class="line">    this.subs = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Dep.prototype.addSub = function(sub)&#123;</span><br><span class="line">    this.subs.push(sub);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Dep.prototype.notify = function()&#123;</span><br><span class="line">    this.subs.forEach(sub=&gt;sub.update());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Watcher(fn)&#123;</span><br><span class="line">    this.fn = fn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Wathcher.prototype.update = function()&#123;</span><br><span class="line">    this.fn();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var dep = new Dep();</span><br><span class="line">dep.addSub(new Watcher(function()&#123;</span><br><span class="line">    console.log(&#x27;okokok&#x27;);</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">dep.notify();</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E7%BC%96%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E7%BC%96%E7%A0%81/" class="post-title-link" itemprop="url">字符集和编码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">编码</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="字符集（Character-Set）"><a href="#字符集（Character-Set）" class="headerlink" title="字符集（Character Set）"></a>字符集（Character Set）</h3><p>字符的集合，定义系统能处理哪些字符；</p>
<h3 id="编码方式（Encoding）"><a href="#编码方式（Encoding）" class="headerlink" title="编码方式（Encoding）"></a>编码方式（Encoding）</h3><p>规定这些字符在计算机内部的表示（存储形式）</p>
<h3 id="码点（Code-Point）"><a href="#码点（Code-Point）" class="headerlink" title="码点（Code Point）"></a>码点（Code Point）</h3><p>每一个字符的编码就是一个码点（字符在字符集中的表示）</p>
<h2 id="列几种常见的字符集和编码方式"><a href="#列几种常见的字符集和编码方式" class="headerlink" title="列几种常见的字符集和编码方式"></a>列几种常见的字符集和编码方式</h2><h3 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h3><ul>
<li>ASCII(American Standard Code for Information Interchange，美国信息交换标准代码)</li>
</ul>
<p>是比较早的一种编码字符集，里面包含了 128 种字符，囊括了英文中常用的字母、数字、标点符号。另外还考虑了一些计算机的特定行为，比如响铃等等。</p>
<ul>
<li>GBK</li>
</ul>
<p>GBK 是对 GB2312 的一个扩展，兼容 GB2312，因此也兼容 ASCII，也是一个变长编码方案。下面是一个简介：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GBK 总体编码范围为 8140-FEFE，首字节在 81-FE 之间，尾字节在 40-FE 之间，总计 23940 个码位，共收入 21886 个汉字和图形符号，其中汉字（包括部首和构件）21003 个，图形符号 883 个。</span><br></pre></td></tr></table></figure>

<ul>
<li>Unicode</li>
</ul>
<p>Unicode 字符集的容量其实是在不断扩充中的。它规定，一个 16 位即 2Byte 的空间为一个平面（plane），一个平面的容量就是 2^16 &#x3D; 65536。目前 Unicode 已经定义了 17 个平面，即 17 * 65536 大约 100 万这么多容量。如果不够还可以继续扩充至 18 平面、19 平面 ……</p>
<p>Unicode 的编码一般使用十六进制表示，前面加一个 U+，比如「汉」的 Unicode 编码是 U+6C49, a 的 Unicode 编码是 U+0061. 补充前面两个 0 是一种通常的记法。</p>
<h4 id="编码方式"><a href="#编码方式" class="headerlink" title="编码方式"></a>编码方式</h4><ul>
<li><p>ASCII</p>
</li>
<li><p>GBK</p>
</li>
<li><p>utf-16、utf-8</p>
</li>
<li><p>emoji</p>
</li>
<li><p>base64</p>
<p>base64 编码是用来解决把不可打印的内容塞进可打印内容的需求的。比如把图片存到数据库，图片数据归根到底还是一堆二进制串，用 base64 编码后的显示成的字符串就大大缩小的长度，可以存到数据库。</p>
<p>所谓 Base64，就是:小写字母 a-z、大写字母 A-Z、数字 0-9、符号”+”、”&#x2F;“（再加上作为垫字的”&#x3D;”，实际上是 65 个字符）—-作为一个基本字符集。然后，其他所有符号都转换成这个字符集中的字符。</p>
</li>
</ul>
<h3 id="理解字符集和编码方式"><a href="#理解字符集和编码方式" class="headerlink" title="理解字符集和编码方式"></a>理解字符集和编码方式</h3><p>ASCII、GBK 等类编码模式的字符集和编码方式都是一一对应的，Unicode 是字符集，UTF-32&#x2F; UTF-16&#x2F; UTF-8 是三种字符编码方案。</p>
<p>在早期的编码字符集中，如 ASCII，都是存储器里面直接放入编码字符集的对应编码，字符的编号是什么，就直接用这个编号作为存储中的编码。这在 ASCII 这样字符集中是没问题的。</p>
<p>但是 Unicode 就会有上面的问题。因为 Unicode 有 17 个编码空间，17 超过了 2^4 &#x3D; 16，实际上用到了 2^5 的容量，再加上每个平面都是 2^16，其实一共是 5 + 16 &#x3D; 21 位。在 1Byte &#x3D; 8 bit 的硬件设备中，要使用定长的方式表示 Unicode，就会用到 3Byte。这样英文字符所占的空间就会 ASCII 情况下多三倍。而 Unicode 作为一种现代字符编码规则，用了一种截然的不同的策略。 那就是把每一个字符的编码，用一种特殊的规则映射到编码之上。这样的策略过程就是「编码方式」（charset encoding），Unicode 有很多编码方式，我们常见的有<code>utf-8</code>、<code>utf-16</code></p>
<h3 id="URI-编码"><a href="#URI-编码" class="headerlink" title="URI 编码"></a>URI 编码</h3><p>考虑到 URI 在各种平台间传输时的兼容性，<code>URI 规范中规定只有 US-ASCII 字符集中的字符</code>可以直接出现在 URI 中。事实上，甚至 ASCII 本身的许多字符也不允许直接出现在 URI 中，有的也要转义。URL 路径中的中文需要转义，具体编码用的是 utf-8。</p>
<p><strong>encodeURI:</strong> 会将需要编码的字符转换为 UTF-8 的格式。对于非转义字符以及保留字符（;,&#x2F;?:@&amp;&#x3D;+$#）不会进行转义。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// URL中包含中文</span></span><br><span class="line"><span class="built_in">encodeURI</span>(<span class="string">&#x27;http://www.帅.com&#x27;</span>); <span class="comment">// http://www.%E5%B8%85.com</span></span><br><span class="line">​</span><br><span class="line"><span class="comment">// 值的内容为特殊符号。值为?&amp;</span></span><br><span class="line"><span class="built_in">encodeURI</span>(<span class="string">&#x27;http://a.com?key=?&amp;&#x27;</span>); <span class="comment">// &quot;http://a.com?key=?&amp;&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>encodeURIComponent:</strong> 会编码所有的 URL 保留字：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">encodeURIComponent</span>(<span class="string">&#x27;https://aotu.io/&#x27;</span>)</span><br><span class="line"><span class="comment">// &quot;https%3A%2F%2Faotu.io%2F&quot;</span></span><br><span class="line">​</span><br><span class="line"><span class="built_in">encodeURI</span>(<span class="string">&#x27;https://aotu.io/&#x27;</span>)</span><br><span class="line"><span class="comment">// &quot;https://aotu.io/&quot;</span></span><br></pre></td></tr></table></figure>

<p>在处理页面跳转、跟服务器端进行交互时, 凡涉及到对 URI 进行解析的、最好用<strong>encodeURIComponent</strong>进行编码避免部分数据的丢失</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/" class="post-title-link" itemprop="url">拓扑排序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>拓扑排序是一种常用的有向无环图（DAG）的排序算法。它可以将 DAG 中的节点按照一定的顺序进行排序，使得对于任意一条有向边(u, v)，起点 u 在排序结果中都排在终点 v 的前面。</p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>拓扑排序解决依赖关系的原理是基于有向无环图（DAG）的特性。在 DAG 中，每个节点都有一个入度，表示有多少条有向边指向该节点。如果存在环，则说明存在循环依赖，无法进行拓扑排序。</p>
<p>在一个依赖关系中，每个节点代表一个任务或模块，有些模块必须在其他模块前执行，这种依赖关系用 DAG 来表示，其中每个节点代表一个任务或者模块，每条有向边（u,v）表示模块 u 依赖于模块 v</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>拓扑排序会首先找到所有入度为 0 的节点，并将它们加入排序结果中。然后，删除与这些节点相邻的边，并更新相邻节点的入度。重复这个过程，直到所有节点都被排序。</p>
<p>在依赖关系中，每个节点的入度表示有多少个任务或模块依赖于它。如果一个节点的入度为 0，则说明它没有任何依赖关系，可以直接执行或加载。如果一个节点的入度不为 0，则说明它有依赖关系，必须等待依赖它的任务或模块执行或加载完成后才能执行或加载。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">topoSort</span>(<span class="params">graph</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> nodes = <span class="title class_">Object</span>.<span class="title function_">keys</span>(graph);</span><br><span class="line">  <span class="keyword">const</span> inDegree = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> queue = [];</span><br><span class="line">  <span class="keyword">const</span> result = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化入度为0</span></span><br><span class="line">  nodes.<span class="title function_">forEach</span>(<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">    inDegree[node] = <span class="number">0</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 计算每个节点的入度</span></span><br><span class="line">  nodes.<span class="title function_">forEach</span>(<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> neighbors = graph[node];</span><br><span class="line">    neighbors.<span class="title function_">forEach</span>(<span class="function"><span class="params">neighbor</span> =&gt;</span> &#123;</span><br><span class="line">      inDegree[neighbor]++;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将入度为0的节点加入队列</span></span><br><span class="line">  nodes.<span class="title function_">forEach</span>(<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (inDegree[node] === <span class="number">0</span>) &#123;</span><br><span class="line">      queue.<span class="title function_">push</span>(node);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 每次选择入度为0的节点进行排序</span></span><br><span class="line">  <span class="keyword">while</span> (queue.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> node = queue.<span class="title function_">shift</span>();</span><br><span class="line">    result.<span class="title function_">push</span>(node);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> neighbors = graph[node];</span><br><span class="line">    neighbors.<span class="title function_">forEach</span>(<span class="function"><span class="params">neighbor</span> =&gt;</span> &#123;</span><br><span class="line">      inDegree[neighbor]--;</span><br><span class="line">      <span class="keyword">if</span> (inDegree[neighbor] === <span class="number">0</span>) &#123;</span><br><span class="line">        queue.<span class="title function_">push</span>(neighbor);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果图中存在环，则无法进行拓扑排序</span></span><br><span class="line">  <span class="keyword">if</span> (result.<span class="property">length</span> !== nodes.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;The graph contains a cycle&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：将有向图进行拓扑排序</span></span><br><span class="line"><span class="keyword">const</span> graph = &#123;</span><br><span class="line">  <span class="string">&#x27;A&#x27;</span>: [<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>],</span><br><span class="line">  <span class="string">&#x27;B&#x27;</span>: [<span class="string">&#x27;D&#x27;</span>],</span><br><span class="line">  <span class="string">&#x27;C&#x27;</span>: [<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>],</span><br><span class="line">  <span class="string">&#x27;D&#x27;</span>: [<span class="string">&#x27;E&#x27;</span>],</span><br><span class="line">  <span class="string">&#x27;E&#x27;</span>: []</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sortedNodes = <span class="title function_">topoSort</span>(graph);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sortedNodes); <span class="comment">// [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;]</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/%E6%9F%AF%E9%87%8C%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/%E6%9F%AF%E9%87%8C%E5%8C%96/" class="post-title-link" itemprop="url">柯里化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JS%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">JS相关</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JS%E7%9B%B8%E5%85%B3/%E6%9F%AF%E9%87%8C%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">柯里化</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>柯里化是一种将使用多个参数的一个函数转换成一系列使用一个参数的函数,并且返回接受余下的参数而且返回结果的新函数的新技术。</p>
<h3 id="实现关键"><a href="#实现关键" class="headerlink" title="实现关键"></a>实现关键</h3><p>比较多次接受的参数总数与函数定义时的入参数量，当接受参数的数量大于或等于被Currying函数的传入参数数量时，就返回计算结果，否则返回一个继续接受参数的函数</p>
<h3 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h3><p>参数复用。本质上是降低通用性，提高适用性</p>
<p>比如有一段数据<br><br><code>var person =  [&#123;name:&#39;kevin&#39;&#125;,&#123;name:&#39;daisy&#39;&#125;]</code></p>
<p>如果我们要获取所有的name值，我们可以这样做：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var name = person.map(function(item)&#123;</span><br><span class="line">    return item.name;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>不过如果我们有curry函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var prop = curry(function(key,obj)&#123;</span><br><span class="line">    return obj[key]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">var name = person.map(prop(&#x27;name&#x27;))</span><br></pre></td></tr></table></figure>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function currying(fn) &#123;</span><br><span class="line">           let args = Array.prototype.slice.call(arguments, 1)</span><br><span class="line">           if (args.length &lt; fn.length) &#123;</span><br><span class="line">               return function () &#123;</span><br><span class="line">                   let binArgs = Array.prototype.slice.call(arguments);</span><br><span class="line">                   return currying(fn, ...args, ...arguments);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; else &#123;</span><br><span class="line">               return fn.apply(null, args);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<h4 id="精简实现"><a href="#精简实现" class="headerlink" title="精简实现"></a>精简实现</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const curry = (fn,...args)=&gt;&#123;</span><br><span class="line">    args.length &lt; fn.length</span><br><span class="line">    //参数长度不足时，重新柯里化该函数，等待接受新参数</span><br><span class="line">    ?(...arguments)=&gt; curry(fn,...args,...arguments)</span><br><span class="line">    //参数长度满足时，执行函数</span><br><span class="line">    :fn(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function sumFn(a,b,c)&#123;</span><br><span class="line">    return a + b + c;</span><br><span class="line">&#125;</span><br><span class="line">var sum = curry(sumFn);</span><br><span class="line">console.log(sum(2)(3)(5));//10</span><br><span class="line">console.log(sum(2,3,5));//10</span><br><span class="line">console.log(sum(2)(3,5));//10</span><br><span class="line">console.log(sum(2,3)(5));//10</span><br></pre></td></tr></table></figure>

<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><ul>
<li>参数复用</li>
<li>提前返回-返回接受余下的参数且返回结果的新函数</li>
<li>延迟执行- 返回新函数，等待执行</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/%E7%BB%A7%E6%89%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/%E7%BB%A7%E6%89%BF/" class="post-title-link" itemprop="url">继承</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JS%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">JS相关</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JS%E7%9B%B8%E5%85%B3/%E7%BB%A7%E6%89%BF/" itemprop="url" rel="index"><span itemprop="name">继承</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="1、原型链继承"><a href="#1、原型链继承" class="headerlink" title="1、原型链继承"></a>1、原型链继承</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Parent () &#123;</span><br><span class="line">    this.name = &#x27;kevin&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Parent.prototype.getName = function () &#123;</span><br><span class="line">    console.log(this.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child () &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Child.prototype = new Parent();</span><br><span class="line"></span><br><span class="line">var child1 = new Child();</span><br><span class="line"></span><br><span class="line">console.log(child1.getName()) // kevin</span><br></pre></td></tr></table></figure>

<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>原先的实例属性变成了现在的原型属性，该原型的引用类型属性会被所有的实例共享</li>
</ul>
<h3 id="2、借助构造函数（经典继承）"><a href="#2、借助构造函数（经典继承）" class="headerlink" title="2、借助构造函数（经典继承）"></a>2、借助构造函数（经典继承）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Parent () &#123;</span><br><span class="line">    this.names = [&#x27;kevin&#x27;, &#x27;daisy&#x27;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child () &#123;</span><br><span class="line">    Parent.call(this);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var child1 = new Child();</span><br><span class="line"></span><br><span class="line">child1.names.push(&#x27;yayu&#x27;);</span><br><span class="line"></span><br><span class="line">console.log(child1.names); // [&quot;kevin&quot;, &quot;daisy&quot;, &quot;yayu&quot;]</span><br><span class="line"></span><br><span class="line">var child2 = new Child();</span><br><span class="line"></span><br><span class="line">console.log(child2.names); // [&quot;kevin&quot;, &quot;daisy&quot;]</span><br></pre></td></tr></table></figure>

<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>方法都在构造函数中定义，函数复用无从谈起，另外超类型原型中定义的方法对于子类型而言都是不可见的</li>
</ul>
<h3 id="3、组合继承"><a href="#3、组合继承" class="headerlink" title="3、组合继承"></a>3、组合继承</h3><p>使用原型链实现对原型属性和方法的继承，通过借用构造函数来实现对实例属性的继承。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">function Parent (name) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.colors = [&#x27;red&#x27;, &#x27;blue&#x27;, &#x27;green&#x27;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Parent.prototype.getName = function () &#123;</span><br><span class="line">    console.log(this.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child (name, age) &#123;</span><br><span class="line"></span><br><span class="line">    Parent.call(this, name);</span><br><span class="line">    </span><br><span class="line">    this.age = age;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Child.prototype = new Parent();</span><br><span class="line"></span><br><span class="line">var child1 = new Child(&#x27;kevin&#x27;, &#x27;18&#x27;);</span><br><span class="line"></span><br><span class="line">child1.colors.push(&#x27;black&#x27;);</span><br><span class="line"></span><br><span class="line">console.log(child1.name); // kevin</span><br><span class="line">console.log(child1.age); // 18</span><br><span class="line">console.log(child1.colors); // [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;black&quot;]</span><br><span class="line"></span><br><span class="line">var child2 = new Child(&#x27;daisy&#x27;, &#x27;20&#x27;);</span><br><span class="line"></span><br><span class="line">console.log(child2.name); // daisy</span><br><span class="line">console.log(child2.age); // 20</span><br><span class="line">console.log(child2.colors); // [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;]</span><br></pre></td></tr></table></figure>

<h4 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>无论什么情况下，都会调用两次超类型构造函数：一次是在创建子类型原型的时候，另一次是在子类型构造函数内部。</li>
</ul>
<h3 id="4、原型式继承"><a href="#4、原型式继承" class="headerlink" title="4、原型式继承"></a>4、原型式继承</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function createObj(o) &#123;</span><br><span class="line">    function F()&#123;&#125;</span><br><span class="line">    F.prototype = o;</span><br><span class="line">    return new F();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是ES5 <code>Object.create</code>的模拟实现，将传入的对象作为创建的对象的原型。</p>
<p>ECMAScript5通过新增<code>Object.create()</code>方法规范了原型式继承。这个方法接受两个参数：一个用作新对象原型的对象和（可选的）一个为新对象定义额外属性的对象（可以覆盖原型对象上的同名属性），在传入一个参数的情况下，<code>Object.create()</code>和<code>object()</code>方法的行为相同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var person = &#123;</span><br><span class="line">    name : &#x27;Yvette&#x27;,</span><br><span class="line">    hobbies:[&#x27;reading&#x27;,&#x27;photography&#x27;]</span><br><span class="line">&#125;</span><br><span class="line">var person1 = Object.create(person);</span><br><span class="line">person1.name = &#x27;Jack&#x27;;</span><br><span class="line">person1.hobbies.push(&#x27;coding&#x27;);</span><br><span class="line">var person2 = Object.create(person);</span><br><span class="line">person2.name = &#x27;Echo&#x27;;</span><br><span class="line">person2.hobbies.push(&#x27;running&#x27;);</span><br><span class="line">cosole.log(person.hobbies);//[&#x27;reading&#x27;,&#x27;photography&#x27;,&#x27;coding&#x27;,&#x27;running&#x27;]</span><br><span class="line">console.log(person1.hobbies);//[&#x27;reading&#x27;,&#x27;photography&#x27;,&#x27;coding&#x27;,&#x27;running&#x27;]</span><br></pre></td></tr></table></figure>

<h4 id="缺点-3"><a href="#缺点-3" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>通原型链继承一样，包含引用类型值的属性会被实例共享。</li>
</ul>
<h3 id="5、寄生式继承"><a href="#5、寄生式继承" class="headerlink" title="5、寄生式继承"></a>5、寄生式继承</h3><p>创建一个仅用于封装继承过程的函数，该函数在内部以某种形式来做增强对象，最后返回对象。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function createObj (o) &#123;</span><br><span class="line">    var clone = object.create(o);</span><br><span class="line">    clone.sayName = function () &#123;</span><br><span class="line">        console.log(&#x27;hi&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    return clone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="缺点-4"><a href="#缺点-4" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>使用寄生式继承来为对象添加函数，会由于不能做到函数复用而效率底下。</li>
<li>同原型链实现继承一样，包含引用类型值的属性会被所有实例共享。</li>
</ul>
<h3 id="6、寄生组合式继承"><a href="#6、寄生组合式继承" class="headerlink" title="6、寄生组合式继承"></a>6、寄生组合式继承</h3><p>即通过借助构造函数来继承属性，通过原型链的混成形式来继承方法。<br><strong>与组合继承相比降低了父类构造函数的开销</strong></p>
<ul>
<li><p>糙版</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">function Parent (name) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.colors = [&#x27;red&#x27;, &#x27;blue&#x27;, &#x27;green&#x27;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Parent.prototype.getName = function () &#123;</span><br><span class="line">    console.log(this.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child (name, age) &#123;</span><br><span class="line">    Parent.call(this, name);</span><br><span class="line">    this.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 关键的三步</span><br><span class="line">var F = function () &#123;&#125;;</span><br><span class="line"></span><br><span class="line">F.prototype = Parent.prototype;</span><br><span class="line"></span><br><span class="line">Child.prototype = new F();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var child1 = new Child(&#x27;kevin&#x27;, &#x27;18&#x27;);</span><br><span class="line"></span><br><span class="line">console.log(child1);</span><br></pre></td></tr></table></figure>
</li>
<li><p>精简</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function inheritPrototype(subType,superType)&#123;</span><br><span class="line">    var prototype = object(superType.prototype);//创建对象</span><br><span class="line">    prototype.constructor = subType;//增强对象</span><br><span class="line">    subType.prototype = prototype;//指定对象</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>prototype.constructor = subType有何作用？</code></p>
</li>
</ul>
<p>因为<code>subType.prototype = o1</code>代码重写了<code>subType</code>的原型对象，这时的原型已经与最初的<code>subType</code>原型对象失去联系，从而需要校正<code>subType</code>的<code>constructor</code>。</p>
<p><a href="https://segmentfault.com/a/1190000015727237">参考链接</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/%E8%A3%85%E9%A5%B0%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/%E8%A3%85%E9%A5%B0%E5%99%A8/" class="post-title-link" itemprop="url">装饰器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="什么是装饰器"><a href="#什么是装饰器" class="headerlink" title="什么是装饰器"></a>什么是装饰器</h3><p>装饰器是一个对类进行处理的函数。装饰器函数的第一个参数，就是所要装饰的目标类。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@decorator</span><br><span class="line">class A &#123;&#125;</span><br><span class="line"></span><br><span class="line">//等同于</span><br><span class="line">class A &#123;&#125;</span><br><span class="line">A = decorator(A) || A;</span><br></pre></td></tr></table></figure>

<h3 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//src/decorators/CursorPointer.js</span><br><span class="line">import React from &#x27;react&#x27;</span><br><span class="line"></span><br><span class="line">export default Component =&gt; class extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return &lt;div style=&#123;&#123;cursor:&#x27;pointer&#x27;,display:&#x27;inline-block&#x27;&#125;&#125;&gt;</span><br><span class="line">            &lt;Component&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个装饰器（高阶组件）接受一个React组件作为参数，然后返回一个新的React组件。实现比较简单，包裹一个div,添加了一个style,就这么简单。以后所有被它装饰的组件都会具有这个特征</p>
<p>使用这个装饰器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;</span><br><span class="line">import Clickable from &#x27;../decorators/CursorPointer&#x27;</span><br><span class="line"></span><br><span class="line">@Clickable</span><br><span class="line">class ClickablePanel extends React.Component &#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return &lt;div className=&quot;panel&quot;&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//定义一个函数，也就是定义一个Decorator，target参数就是传进来的Class。</span><br><span class="line">//这里是为类添加了一个静态属性</span><br><span class="line">function testable(target) &#123;</span><br><span class="line">  target.isTestable = true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//在Decorator后面跟着Class，Decorator是函数的话，怎么不是testable(MyTestableClass)这样写呢？</span><br><span class="line">//我只能这样理解：因为语法就这样，只要Decorator后面是Class，默认就已经把Class当成参数隐形传进Decorator了。</span><br><span class="line">@testable</span><br><span class="line">class MyTestableClass &#123;&#125;</span><br><span class="line"></span><br><span class="line">console.log(MyTestableClass.isTestable) // true</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/09/03/this%E7%90%86%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luzy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Luzy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/03/this%E7%90%86%E8%A7%A3/" class="post-title-link" itemprop="url">this理解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-03 10:41:52" itemprop="dateCreated datePublished" datetime="2024-09-03T10:41:52+08:00">2024-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JS%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">JS相关</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JS%E7%9B%B8%E5%85%B3/new-this/" itemprop="url" rel="index"><span itemprop="name">new&this</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1、this是什么"><a href="#1、this是什么" class="headerlink" title="1、this是什么"></a>1、<code>this</code>是什么</h2><ul>
<li>this是JavaScript的一个关键字</li>
<li>this不是function本身。</li>
<li>this也不是function的scope</li>
<li>this和function在哪里声明没有关系，而是取决于function被调用的方式（<strong>即谁调用它，this就指向谁</strong>）</li>
</ul>
<h2 id="2、影响this的因素"><a href="#2、影响this的因素" class="headerlink" title="2、影响this的因素"></a>2、影响<code>this</code>的因素</h2><h3 id="2-1、环境因素"><a href="#2-1、环境因素" class="headerlink" title="2.1、环境因素"></a>2.1、环境因素</h3><p>浏览器环境：无论是否在严格模式下，在<strong>全局执行环境下</strong>（在任何函数体外部）this都指向全局对象<code>window</code></br><br>node环境：无论是否在严格模式下，在全局执行环境下（在任何函数体外部），this都是空对象<code>&#123;&#125;</code></br><br>非严格模式：node环境，指向全局对象global,浏览器环境，指向全局对象window</br><br>非严格模式：执行undefined</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function hello(thing)&#123;</span><br><span class="line">    console.log(&quot;Hello&quot; + thing);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hello(&quot;world&quot;)</span><br><span class="line"></span><br><span class="line">//等同于</span><br><span class="line">hello.call(window,&quot;world&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-显示调用"><a href="#2-2-显示调用" class="headerlink" title="2.2 显示调用"></a>2.2 显示调用</h3><h4 id="2-2-1-new操作符"><a href="#2-2-1-new操作符" class="headerlink" title="2.2.1 new操作符"></a>2.2.1 <code>new</code>操作符</h4><p>如果是<code>new</code>绑定，并且构造函数中没有返回function或者是object,那么this指向这个新对象。</p>
<h4 id="2-2-2-call、apply、bind调用"><a href="#2-2-2-call、apply、bind调用" class="headerlink" title="2.2.2 call、apply、bind调用"></a>2.2.2 <code>call</code>、<code>apply</code>、<code>bind</code>调用</h4><p>通过这三个方法调用，则<code>this</code><br>绑定的就是指定的对象</p>
<ul>
<li><code>apply</code>使用参数数组（或类数组）</li>
<li><code>call</code>使用参数列表</li>
</ul>
<h3 id="2-3-隐式调用"><a href="#2-3-隐式调用" class="headerlink" title="2.3 隐式调用"></a>2.3 隐式调用</h3><h4 id="2-3-1-函数的调用是在某个对象上触发的。xxx-fn"><a href="#2-3-1-函数的调用是在某个对象上触发的。xxx-fn" class="headerlink" title="2.3.1 函数的调用是在某个对象上触发的。xxx.fn()"></a>2.3.1 函数的调用是在某个对象上触发的。<code>xxx.fn()</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var person = &#123;</span><br><span class="line">            name:&#x27;Luzy&#x27;,</span><br><span class="line">            hello:function(thing)&#123;</span><br><span class="line">                console.log(this.name + &quot; says hello &quot; + thing);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        person.hello(&quot;world&quot;);</span><br><span class="line">        //等同于</span><br><span class="line">        person.hello.call(person,&quot;world&quot;);</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-箭头函数"><a href="#2-3-2-箭头函数" class="headerlink" title="2.3.2 箭头函数"></a>2.3.2 箭头函数</h4><p>箭头函数没有自己的this,继承外层上下文绑定的this</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var age = 26;</span><br><span class="line">let obj = &#123;</span><br><span class="line">    age:20,</span><br><span class="line">    info:() =&gt;&#123;</span><br><span class="line">        console.log(this,this.age);</span><br><span class="line">    &#125;,</span><br><span class="line">    info1: function () &#123;</span><br><span class="line">        console.log(this,this.age)</span><br><span class="line">    &#125;,</span><br><span class="line">    info2:function()&#123;</span><br><span class="line">        console.log(age);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line">obj.info();//window 26</span><br><span class="line">obj.info1();//obj 20</span><br><span class="line">obj.info2();//26</span><br></pre></td></tr></table></figure>
<p>解释一下，<code>obj.info2()</code>这里<code>obj</code>不是一个函数，因此<code>obj.info2()</code>其实是一个全局声明的函数，根据<strong>词法作用域规则</strong>输出26。</p>
<p><strong>this系统和作用域链是两套不一样的系统</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Luzy</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
